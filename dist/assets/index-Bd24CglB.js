(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))m(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&m(n)}).observe(document,{childList:!0,subtree:!0});function f(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function m(s){if(s.ep)return;s.ep=!0;const t=f(s);fetch(s.href,t)}})();var W={},Z,de;function Me(){if(de)return Z;de=1;function I(s){var t=new m(s),n=t.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var c=h(n.data),o=[],r=0;!t.eof()&&r<c.numTracks;r++){var e=t.readChunk();if(e.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+e.id+"'";var l=f(e.data);o.push(l)}return{header:c,tracks:o}}function h(s){var t=new m(s),n=t.readUInt16(),c=t.readUInt16(),o={format:n,numTracks:c},r=t.readUInt16();return r&32768?(o.framesPerSecond=256-(r>>8),o.ticksPerFrame=r&255):o.ticksPerBeat=r,o}function f(s){for(var t=new m(s),n=[];!t.eof();){var c=r();n.push(c)}return n;var o;function r(){var e={};e.deltaTime=t.readVarInt();var l=t.readUInt8();if((l&240)===240)if(l===255){e.meta=!0;var u=t.readUInt8(),d=t.readVarInt();switch(u){case 0:if(e.type="sequenceNumber",d!==2)throw"Expected length for sequenceNumber event is 2, got "+d;return e.number=t.readUInt16(),e;case 1:return e.type="text",e.text=t.readString(d),e;case 2:return e.type="copyrightNotice",e.text=t.readString(d),e;case 3:return e.type="trackName",e.text=t.readString(d),e;case 4:return e.type="instrumentName",e.text=t.readString(d),e;case 5:return e.type="lyrics",e.text=t.readString(d),e;case 6:return e.type="marker",e.text=t.readString(d),e;case 7:return e.type="cuePoint",e.text=t.readString(d),e;case 32:if(e.type="channelPrefix",d!=1)throw"Expected length for channelPrefix event is 1, got "+d;return e.channel=t.readUInt8(),e;case 33:if(e.type="portPrefix",d!=1)throw"Expected length for portPrefix event is 1, got "+d;return e.port=t.readUInt8(),e;case 47:if(e.type="endOfTrack",d!=0)throw"Expected length for endOfTrack event is 0, got "+d;return e;case 81:if(e.type="setTempo",d!=3)throw"Expected length for setTempo event is 3, got "+d;return e.microsecondsPerBeat=t.readUInt24(),e;case 84:if(e.type="smpteOffset",d!=5)throw"Expected length for smpteOffset event is 5, got "+d;var i=t.readUInt8(),p={0:24,32:25,64:29,96:30};return e.frameRate=p[i&96],e.hour=i&31,e.min=t.readUInt8(),e.sec=t.readUInt8(),e.frame=t.readUInt8(),e.subFrame=t.readUInt8(),e;case 88:if(e.type="timeSignature",d!=2&&d!=4)throw"Expected length for timeSignature event is 4 or 2, got "+d;return e.numerator=t.readUInt8(),e.denominator=1<<t.readUInt8(),d===4?(e.metronome=t.readUInt8(),e.thirtyseconds=t.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",d!=2)throw"Expected length for keySignature event is 2, got "+d;return e.key=t.readInt8(),e.scale=t.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=t.readBytes(d),e;default:return e.type="unknownMeta",e.data=t.readBytes(d),e.metatypeByte=u,e}}else if(l==240){e.type="sysEx";var d=t.readVarInt();return e.data=t.readBytes(d),e}else if(l==247){e.type="endSysEx";var d=t.readVarInt();return e.data=t.readBytes(d),e}else throw"Unrecognised MIDI event type byte: "+l;else{var g;if((l&128)===0){if(o===null)throw"Running status byte encountered before status byte";g=l,l=o,e.running=!0}else g=t.readUInt8(),o=l;var a=l>>4;switch(e.channel=l&15,a){case 8:return e.type="noteOff",e.noteNumber=g,e.velocity=t.readUInt8(),e;case 9:var y=t.readUInt8();return e.type=y===0?"noteOff":"noteOn",e.noteNumber=g,e.velocity=y,y===0&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=g,e.amount=t.readUInt8(),e;case 11:return e.type="controller",e.controllerType=g,e.value=t.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=g,e;case 13:return e.type="channelAftertouch",e.amount=g,e;case 14:return e.type="pitchBend",e.value=g+(t.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+a}}}}function m(s){this.buffer=s,this.bufferLen=this.buffer.length,this.pos=0}return m.prototype.eof=function(){return this.pos>=this.bufferLen},m.prototype.readUInt8=function(){var s=this.buffer[this.pos];return this.pos+=1,s},m.prototype.readInt8=function(){var s=this.readUInt8();return s&128?s-256:s},m.prototype.readUInt16=function(){var s=this.readUInt8(),t=this.readUInt8();return(s<<8)+t},m.prototype.readInt16=function(){var s=this.readUInt16();return s&32768?s-65536:s},m.prototype.readUInt24=function(){var s=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8();return(s<<16)+(t<<8)+n},m.prototype.readInt24=function(){var s=this.readUInt24();return s&8388608?s-16777216:s},m.prototype.readUInt32=function(){var s=this.readUInt8(),t=this.readUInt8(),n=this.readUInt8(),c=this.readUInt8();return(s<<24)+(t<<16)+(n<<8)+c},m.prototype.readBytes=function(s){var t=this.buffer.slice(this.pos,this.pos+s);return this.pos+=s,t},m.prototype.readString=function(s){var t=this.readBytes(s);return String.fromCharCode.apply(null,t)},m.prototype.readVarInt=function(){for(var s=0;!this.eof();){var t=this.readUInt8();if(t&128)s+=t&127,s<<=7;else return s+t}return s},m.prototype.readChunk=function(){var s=this.readString(4),t=this.readUInt32(),n=this.readBytes(t);return{id:s,length:t,data:n}},Z=I,Z}var ee,fe;function Pe(){if(fe)return ee;fe=1;function I(t,n){if(typeof t!="object")throw"Invalid MIDI data";n=n||{};var c=t.header||{},o=t.tracks||[],r,e=o.length,l=new s;for(h(l,c,e),r=0;r<e;r++)f(l,o[r],n);return l.buffer}function h(t,n,c){var o=n.format==null?1:n.format,r=128;n.timeDivision?r=n.timeDivision:n.ticksPerFrame&&n.framesPerSecond?r=-(n.framesPerSecond&255)<<8|n.ticksPerFrame&255:n.ticksPerBeat&&(r=n.ticksPerBeat&32767);var e=new s;e.writeUInt16(o),e.writeUInt16(c),e.writeUInt16(r),t.writeChunk("MThd",e.buffer)}function f(t,n,c){var o=new s,r,e=n.length,l=null;for(r=0;r<e;r++)(c.running===!1||!c.running&&!n[r].running)&&(l=null),l=m(o,n[r],l,c.useByte9ForNoteOff);t.writeChunk("MTrk",o.buffer)}function m(t,n,c,o){var r=n.type,e=n.deltaTime,l=n.text||"",u=n.data||[],d=null;switch(t.writeVarInt(e),r){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(n.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(l.length),t.writeString(l);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(l.length),t.writeString(l);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(l.length),t.writeString(l);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(l.length),t.writeString(l);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(l.length),t.writeString(l);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(l.length),t.writeString(l);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(l.length),t.writeString(l);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(n.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(n.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(n.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var i={24:0,25:32,29:64,30:96},p=n.hour&31|i[n.frameRate];t.writeUInt8(p),t.writeUInt8(n.min),t.writeUInt8(n.sec),t.writeUInt8(n.frame),t.writeUInt8(n.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(n.numerator);var g=Math.floor(Math.log(n.denominator)/Math.LN2)&255;t.writeUInt8(g),t.writeUInt8(n.metronome),t.writeUInt8(n.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(n.key),t.writeUInt8(n.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(u.length),t.writeBytes(u);break;case"unknownMeta":n.metatypeByte!=null&&(t.writeUInt8(255),t.writeUInt8(n.metatypeByte),t.writeVarInt(u.length),t.writeBytes(u));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(u.length),t.writeBytes(u);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(u.length),t.writeBytes(u);break;case"noteOff":var a=o!==!1&&n.byte9||o&&n.velocity==0?144:128;d=a|n.channel,d!==c&&t.writeUInt8(d),t.writeUInt8(n.noteNumber),t.writeUInt8(n.velocity);break;case"noteOn":d=144|n.channel,d!==c&&t.writeUInt8(d),t.writeUInt8(n.noteNumber),t.writeUInt8(n.velocity);break;case"noteAftertouch":d=160|n.channel,d!==c&&t.writeUInt8(d),t.writeUInt8(n.noteNumber),t.writeUInt8(n.amount);break;case"controller":d=176|n.channel,d!==c&&t.writeUInt8(d),t.writeUInt8(n.controllerType),t.writeUInt8(n.value);break;case"programChange":d=192|n.channel,d!==c&&t.writeUInt8(d),t.writeUInt8(n.programNumber);break;case"channelAftertouch":d=208|n.channel,d!==c&&t.writeUInt8(d),t.writeUInt8(n.amount);break;case"pitchBend":d=224|n.channel,d!==c&&t.writeUInt8(d);var y=8192+n.value,v=y&127,k=y>>7&127;t.writeUInt8(v),t.writeUInt8(k);break;default:throw"Unrecognized event type: "+r}return d}function s(){this.buffer=[]}return s.prototype.writeUInt8=function(t){this.buffer.push(t&255)},s.prototype.writeInt8=s.prototype.writeUInt8,s.prototype.writeUInt16=function(t){var n=t>>8&255,c=t&255;this.writeUInt8(n),this.writeUInt8(c)},s.prototype.writeInt16=s.prototype.writeUInt16,s.prototype.writeUInt24=function(t){var n=t>>16&255,c=t>>8&255,o=t&255;this.writeUInt8(n),this.writeUInt8(c),this.writeUInt8(o)},s.prototype.writeInt24=s.prototype.writeUInt24,s.prototype.writeUInt32=function(t){var n=t>>24&255,c=t>>16&255,o=t>>8&255,r=t&255;this.writeUInt8(n),this.writeUInt8(c),this.writeUInt8(o),this.writeUInt8(r)},s.prototype.writeInt32=s.prototype.writeUInt32,s.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},s.prototype.writeString=function(t){var n,c=t.length,o=[];for(n=0;n<c;n++)o.push(t.codePointAt(n));this.writeBytes(o)},s.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var n=t,c=[];for(c.push(n&127),n>>=7;n;){var o=n&127|128;c.push(o),n>>=7}this.writeBytes(c.reverse())}},s.prototype.writeChunk=function(t,n){this.writeString(t),this.writeUInt32(n.length),this.writeBytes(n)},ee=I,ee}var he;function Be(){return he||(he=1,W.parseMidi=Me(),W.writeMidi=Pe()),W}var Oe=Be(),K={exports:{}},Ce=K.exports,pe;function Ne(){return pe||(pe=1,function(I,h){(function(f,m){I.exports=m()})(typeof self<"u"?self:Ce,function(){return(()=>{var f={507:(t,n,c)=>{function o(e){var l=[];return r(e,l),l}function r(e,l){for(var u=0;u<e.length;u++){var d=e[u];Array.isArray(d)?r(d,l):l.push(d)}}c.r(n),c.d(n,{flatten:()=>o})},289:(t,n,c)=>{n.parseMidi=c(666),n.writeMidi=c(865)},666:t=>{function n(o){for(var r,e=new c(o),l=[];!e.eof();){var u=d();l.push(u)}return l;function d(){var i={};i.deltaTime=e.readVarInt();var p=e.readUInt8();if((240&p)==240){if(p!==255){if(p==240)return i.type="sysEx",a=e.readVarInt(),i.data=e.readBytes(a),i;if(p==247)return i.type="endSysEx",a=e.readVarInt(),i.data=e.readBytes(a),i;throw"Unrecognised MIDI event type byte: "+p}i.meta=!0;var g=e.readUInt8(),a=e.readVarInt();switch(g){case 0:if(i.type="sequenceNumber",a!==2)throw"Expected length for sequenceNumber event is 2, got "+a;return i.number=e.readUInt16(),i;case 1:return i.type="text",i.text=e.readString(a),i;case 2:return i.type="copyrightNotice",i.text=e.readString(a),i;case 3:return i.type="trackName",i.text=e.readString(a),i;case 4:return i.type="instrumentName",i.text=e.readString(a),i;case 5:return i.type="lyrics",i.text=e.readString(a),i;case 6:return i.type="marker",i.text=e.readString(a),i;case 7:return i.type="cuePoint",i.text=e.readString(a),i;case 32:if(i.type="channelPrefix",a!=1)throw"Expected length for channelPrefix event is 1, got "+a;return i.channel=e.readUInt8(),i;case 33:if(i.type="portPrefix",a!=1)throw"Expected length for portPrefix event is 1, got "+a;return i.port=e.readUInt8(),i;case 47:if(i.type="endOfTrack",a!=0)throw"Expected length for endOfTrack event is 0, got "+a;return i;case 81:if(i.type="setTempo",a!=3)throw"Expected length for setTempo event is 3, got "+a;return i.microsecondsPerBeat=e.readUInt24(),i;case 84:if(i.type="smpteOffset",a!=5)throw"Expected length for smpteOffset event is 5, got "+a;var y=e.readUInt8();return i.frameRate={0:24,32:25,64:29,96:30}[96&y],i.hour=31&y,i.min=e.readUInt8(),i.sec=e.readUInt8(),i.frame=e.readUInt8(),i.subFrame=e.readUInt8(),i;case 88:if(i.type="timeSignature",a!=4)throw"Expected length for timeSignature event is 4, got "+a;return i.numerator=e.readUInt8(),i.denominator=1<<e.readUInt8(),i.metronome=e.readUInt8(),i.thirtyseconds=e.readUInt8(),i;case 89:if(i.type="keySignature",a!=2)throw"Expected length for keySignature event is 2, got "+a;return i.key=e.readInt8(),i.scale=e.readUInt8(),i;case 127:return i.type="sequencerSpecific",i.data=e.readBytes(a),i;default:return i.type="unknownMeta",i.data=e.readBytes(a),i.metatypeByte=g,i}}else{var v;if((128&p)==0){if(r===null)throw"Running status byte encountered before status byte";v=p,p=r,i.running=!0}else v=e.readUInt8(),r=p;var k=p>>4;switch(i.channel=15&p,k){case 8:return i.type="noteOff",i.noteNumber=v,i.velocity=e.readUInt8(),i;case 9:var b=e.readUInt8();return i.type=b===0?"noteOff":"noteOn",i.noteNumber=v,i.velocity=b,b===0&&(i.byte9=!0),i;case 10:return i.type="noteAftertouch",i.noteNumber=v,i.amount=e.readUInt8(),i;case 11:return i.type="controller",i.controllerType=v,i.value=e.readUInt8(),i;case 12:return i.type="programChange",i.programNumber=v,i;case 13:return i.type="channelAftertouch",i.amount=v,i;case 14:return i.type="pitchBend",i.value=v+(e.readUInt8()<<7)-8192,i;default:throw"Unrecognised MIDI event type: "+k}}}}function c(o){this.buffer=o,this.bufferLen=this.buffer.length,this.pos=0}c.prototype.eof=function(){return this.pos>=this.bufferLen},c.prototype.readUInt8=function(){var o=this.buffer[this.pos];return this.pos+=1,o},c.prototype.readInt8=function(){var o=this.readUInt8();return 128&o?o-256:o},c.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},c.prototype.readInt16=function(){var o=this.readUInt16();return 32768&o?o-65536:o},c.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},c.prototype.readInt24=function(){var o=this.readUInt24();return 8388608&o?o-16777216:o},c.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},c.prototype.readBytes=function(o){var r=this.buffer.slice(this.pos,this.pos+o);return this.pos+=o,r},c.prototype.readString=function(o){var r=this.readBytes(o);return String.fromCharCode.apply(null,r)},c.prototype.readVarInt=function(){for(var o=0;!this.eof();){var r=this.readUInt8();if(!(128&r))return o+r;o+=127&r,o<<=7}return o},c.prototype.readChunk=function(){var o=this.readString(4),r=this.readUInt32();return{id:o,length:r,data:this.readBytes(r)}},t.exports=function(o){var r=new c(o),e=r.readChunk();if(e.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+e.id+"'";for(var l=function(g){var a=new c(g),y={format:a.readUInt16(),numTracks:a.readUInt16()},v=a.readUInt16();return 32768&v?(y.framesPerSecond=256-(v>>8),y.ticksPerFrame=255&v):y.ticksPerBeat=v,y}(e.data),u=[],d=0;!r.eof()&&d<l.numTracks;d++){var i=r.readChunk();if(i.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+i.id+"'";var p=n(i.data);u.push(p)}return{header:l,tracks:u}}},865:t=>{function n(r,e,l){var u,d=new o,i=e.length,p=null;for(u=0;u<i;u++)l.running!==!1&&(l.running||e[u].running)||(p=null),p=c(d,e[u],p,l.useByte9ForNoteOff);r.writeChunk("MTrk",d.buffer)}function c(r,e,l,u){var d=e.type,i=e.deltaTime,p=e.text||"",g=e.data||[],a=null;switch(r.writeVarInt(i),d){case"sequenceNumber":r.writeUInt8(255),r.writeUInt8(0),r.writeVarInt(2),r.writeUInt16(e.number);break;case"text":r.writeUInt8(255),r.writeUInt8(1),r.writeVarInt(p.length),r.writeString(p);break;case"copyrightNotice":r.writeUInt8(255),r.writeUInt8(2),r.writeVarInt(p.length),r.writeString(p);break;case"trackName":r.writeUInt8(255),r.writeUInt8(3),r.writeVarInt(p.length),r.writeString(p);break;case"instrumentName":r.writeUInt8(255),r.writeUInt8(4),r.writeVarInt(p.length),r.writeString(p);break;case"lyrics":r.writeUInt8(255),r.writeUInt8(5),r.writeVarInt(p.length),r.writeString(p);break;case"marker":r.writeUInt8(255),r.writeUInt8(6),r.writeVarInt(p.length),r.writeString(p);break;case"cuePoint":r.writeUInt8(255),r.writeUInt8(7),r.writeVarInt(p.length),r.writeString(p);break;case"channelPrefix":r.writeUInt8(255),r.writeUInt8(32),r.writeVarInt(1),r.writeUInt8(e.channel);break;case"portPrefix":r.writeUInt8(255),r.writeUInt8(33),r.writeVarInt(1),r.writeUInt8(e.port);break;case"endOfTrack":r.writeUInt8(255),r.writeUInt8(47),r.writeVarInt(0);break;case"setTempo":r.writeUInt8(255),r.writeUInt8(81),r.writeVarInt(3),r.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":r.writeUInt8(255),r.writeUInt8(84),r.writeVarInt(5);var y=31&e.hour|{24:0,25:32,29:64,30:96}[e.frameRate];r.writeUInt8(y),r.writeUInt8(e.min),r.writeUInt8(e.sec),r.writeUInt8(e.frame),r.writeUInt8(e.subFrame);break;case"timeSignature":r.writeUInt8(255),r.writeUInt8(88),r.writeVarInt(4),r.writeUInt8(e.numerator);var v=255&Math.floor(Math.log(e.denominator)/Math.LN2);r.writeUInt8(v),r.writeUInt8(e.metronome),r.writeUInt8(e.thirtyseconds||8);break;case"keySignature":r.writeUInt8(255),r.writeUInt8(89),r.writeVarInt(2),r.writeInt8(e.key),r.writeUInt8(e.scale);break;case"sequencerSpecific":r.writeUInt8(255),r.writeUInt8(127),r.writeVarInt(g.length),r.writeBytes(g);break;case"unknownMeta":e.metatypeByte!=null&&(r.writeUInt8(255),r.writeUInt8(e.metatypeByte),r.writeVarInt(g.length),r.writeBytes(g));break;case"sysEx":r.writeUInt8(240),r.writeVarInt(g.length),r.writeBytes(g);break;case"endSysEx":r.writeUInt8(247),r.writeVarInt(g.length),r.writeBytes(g);break;case"noteOff":(a=(u!==!1&&e.byte9||u&&e.velocity==0?144:128)|e.channel)!==l&&r.writeUInt8(a),r.writeUInt8(e.noteNumber),r.writeUInt8(e.velocity);break;case"noteOn":(a=144|e.channel)!==l&&r.writeUInt8(a),r.writeUInt8(e.noteNumber),r.writeUInt8(e.velocity);break;case"noteAftertouch":(a=160|e.channel)!==l&&r.writeUInt8(a),r.writeUInt8(e.noteNumber),r.writeUInt8(e.amount);break;case"controller":(a=176|e.channel)!==l&&r.writeUInt8(a),r.writeUInt8(e.controllerType),r.writeUInt8(e.value);break;case"programChange":(a=192|e.channel)!==l&&r.writeUInt8(a),r.writeUInt8(e.programNumber);break;case"channelAftertouch":(a=208|e.channel)!==l&&r.writeUInt8(a),r.writeUInt8(e.amount);break;case"pitchBend":(a=224|e.channel)!==l&&r.writeUInt8(a);var k=8192+e.value,b=127&k,M=k>>7&127;r.writeUInt8(b),r.writeUInt8(M);break;default:throw"Unrecognized event type: "+d}return a}function o(){this.buffer=[]}o.prototype.writeUInt8=function(r){this.buffer.push(255&r)},o.prototype.writeInt8=o.prototype.writeUInt8,o.prototype.writeUInt16=function(r){var e=r>>8&255,l=255&r;this.writeUInt8(e),this.writeUInt8(l)},o.prototype.writeInt16=o.prototype.writeUInt16,o.prototype.writeUInt24=function(r){var e=r>>16&255,l=r>>8&255,u=255&r;this.writeUInt8(e),this.writeUInt8(l),this.writeUInt8(u)},o.prototype.writeInt24=o.prototype.writeUInt24,o.prototype.writeUInt32=function(r){var e=r>>24&255,l=r>>16&255,u=r>>8&255,d=255&r;this.writeUInt8(e),this.writeUInt8(l),this.writeUInt8(u),this.writeUInt8(d)},o.prototype.writeInt32=o.prototype.writeUInt32,o.prototype.writeBytes=function(r){this.buffer=this.buffer.concat(Array.prototype.slice.call(r,0))},o.prototype.writeString=function(r){var e,l=r.length,u=[];for(e=0;e<l;e++)u.push(r.codePointAt(e));this.writeBytes(u)},o.prototype.writeVarInt=function(r){if(r<0)throw"Cannot write negative variable-length integer";if(r<=127)this.writeUInt8(r);else{var e=r,l=[];for(l.push(127&e),e>>=7;e;){var u=127&e|128;l.push(u),e>>=7}this.writeBytes(l.reverse())}},o.prototype.writeChunk=function(r,e){this.writeString(r),this.writeUInt32(e.length),this.writeBytes(e)},t.exports=function(r,e){if(typeof r!="object")throw"Invalid MIDI data";e=e||{};var l,u=r.header||{},d=r.tracks||[],i=d.length,p=new o;for(function(g,a,y){var v=a.format==null?1:a.format,k=128;a.timeDivision?k=a.timeDivision:a.ticksPerFrame&&a.framesPerSecond?k=-(255&a.framesPerSecond)<<8|255&a.ticksPerFrame:a.ticksPerBeat&&(k=32767&a.ticksPerBeat);var b=new o;b.writeUInt16(v),b.writeUInt16(y),b.writeUInt16(k),g.writeChunk("MThd",b.buffer)}(p,u,i),l=0;l<i;l++)n(p,d[l],e);return p.buffer}},805:(t,n)=>{function c(o,r,e){e===void 0&&(e="ticks");var l=0,u=o.length,d=u;if(u>0&&o[u-1][e]<=r)return u-1;for(;l<d;){var i=Math.floor(l+(d-l)/2),p=o[i],g=o[i+1];if(p[e]===r){for(var a=i;a<o.length;a++)o[a][e]===r&&(i=a);return i}if(p[e]<r&&g[e]>r)return i;p[e]>r?d=i:p[e]<r&&(l=i+1)}return-1}Object.defineProperty(n,"__esModule",{value:!0}),n.insert=n.search=void 0,n.search=c,n.insert=function(o,r,e){if(e===void 0&&(e="ticks"),o.length){var l=c(o,r[e],e);o.splice(l+1,0,r)}else o.push(r)}},543:(t,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.ControlChange=n.controlChangeIds=n.controlChangeNames=void 0,n.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},n.controlChangeIds=Object.keys(n.controlChangeNames).reduce(function(e,l){return e[n.controlChangeNames[l]]=l,e},{});var c=new WeakMap,o=new WeakMap,r=function(){function e(l,u){c.set(this,u),o.set(this,l.controllerType),this.ticks=l.absoluteTime,this.value=l.value}return Object.defineProperty(e.prototype,"number",{get:function(){return o.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return n.controlChangeNames[this.number]?n.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return c.get(this).ticksToSeconds(this.ticks)},set:function(l){var u=c.get(this);this.ticks=u.secondsToTicks(l)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},e}();n.ControlChange=r},906:(t,n,c)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.createControlChanges=void 0;var o=c(543);n.createControlChanges=function(){return new Proxy({},{get:function(r,e){return r[e]?r[e]:o.controlChangeIds.hasOwnProperty(e)?r[o.controlChangeIds[e]]:void 0},set:function(r,e,l){return o.controlChangeIds.hasOwnProperty(e)?r[o.controlChangeIds[e]]=l:r[e]=l,!0}})}},54:function(t,n,c){var o=this&&this.__spreadArray||function(i,p,g){if(g||arguments.length===2)for(var a,y=0,v=p.length;y<v;y++)!a&&y in p||(a||(a=Array.prototype.slice.call(p,0,y)),a[y]=p[y]);return i.concat(a||Array.prototype.slice.call(p))};Object.defineProperty(n,"__esModule",{value:!0}),n.encode=void 0;var r=c(289),e=c(535),l=c(507);function u(i,p){return{absoluteTime:i.ticks,channel:p,controllerType:i.number,deltaTime:0,type:"controller",value:Math.floor(127*i.value)}}function d(i){return{absoluteTime:0,channel:i.channel,deltaTime:0,programNumber:i.instrument.number,type:"programChange"}}n.encode=function(i){var p={header:{format:1,numTracks:i.tracks.length+1,ticksPerBeat:i.header.ppq},tracks:o([o(o(o(o([{absoluteTime:0,deltaTime:0,meta:!0,text:i.header.name,type:"trackName"}],i.header.keySignatures.map(function(g){return function(a){var y=e.keySignatureKeys.indexOf(a.key);return{absoluteTime:a.ticks,deltaTime:0,key:y+7,meta:!0,scale:a.scale==="major"?0:1,type:"keySignature"}}(g)}),!0),i.header.meta.map(function(g){return{absoluteTime:(a=g).ticks,deltaTime:0,meta:!0,text:a.text,type:a.type};var a}),!0),i.header.tempos.map(function(g){return function(a){return{absoluteTime:a.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/a.bpm),type:"setTempo"}}(g)}),!0),i.header.timeSignatures.map(function(g){return function(a){return{absoluteTime:a.ticks,deltaTime:0,denominator:a.timeSignature[1],meta:!0,metronome:24,numerator:a.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(g)}),!0)],i.tracks.map(function(g){return o(o(o([(a=g.name,{absoluteTime:0,deltaTime:0,meta:!0,text:a,type:"trackName"}),d(g)],function(y){return(0,l.flatten)(y.notes.map(function(v){return function(k,b){return[{absoluteTime:k.ticks,channel:b,deltaTime:0,noteNumber:k.midi,type:"noteOn",velocity:Math.floor(127*k.velocity)},{absoluteTime:k.ticks+k.durationTicks,channel:b,deltaTime:0,noteNumber:k.midi,type:"noteOff",velocity:Math.floor(127*k.noteOffVelocity)}]}(v,y.channel)}))}(g),!0),function(y){for(var v=[],k=0;k<127;k++)y.controlChanges.hasOwnProperty(k)&&y.controlChanges[k].forEach(function(b){v.push(u(b,y.channel))});return v}(g),!0),function(y){var v=[];return y.pitchBends.forEach(function(k){v.push(function(b,M){return{absoluteTime:b.ticks,channel:M,deltaTime:0,type:"pitchBend",value:b.value}}(k,y.channel))}),v}(g),!0);var a}),!0)};return p.tracks=p.tracks.map(function(g){g=g.sort(function(y,v){return y.absoluteTime-v.absoluteTime});var a=0;return g.forEach(function(y){y.deltaTime=y.absoluteTime-a,a=y.absoluteTime,delete y.absoluteTime}),g.push({deltaTime:0,meta:!0,type:"endOfTrack"}),g}),new Uint8Array((0,r.writeMidi)(p))}},535:(t,n,c)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.Header=n.keySignatureKeys=void 0;var o=c(805),r=new WeakMap;n.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var e=function(){function l(u){var d=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",r.set(this,480),u){r.set(this,u.header.ticksPerBeat),u.tracks.forEach(function(p){p.forEach(function(g){g.meta&&(g.type==="timeSignature"?d.timeSignatures.push({ticks:g.absoluteTime,timeSignature:[g.numerator,g.denominator]}):g.type==="setTempo"?d.tempos.push({bpm:6e7/g.microsecondsPerBeat,ticks:g.absoluteTime}):g.type==="keySignature"&&d.keySignatures.push({key:n.keySignatureKeys[g.key+7],scale:g.scale===0?"major":"minor",ticks:g.absoluteTime}))})});var i=0;u.tracks[0].forEach(function(p){i+=p.deltaTime,p.meta&&(p.type==="trackName"?d.name=p.text:p.type!=="text"&&p.type!=="cuePoint"&&p.type!=="marker"&&p.type!=="lyrics"||d.meta.push({text:p.text,ticks:i,type:p.type}))}),this.update()}}return l.prototype.update=function(){var u=this,d=0,i=0;this.tempos.sort(function(p,g){return p.ticks-g.ticks}),this.tempos.forEach(function(p,g){var a=g>0?u.tempos[g-1].bpm:u.tempos[0].bpm,y=p.ticks/u.ppq-i,v=60/a*y;p.time=v+d,d=p.time,i+=y}),this.timeSignatures.sort(function(p,g){return p.ticks-g.ticks}),this.timeSignatures.forEach(function(p,g){var a=g>0?u.timeSignatures[g-1]:u.timeSignatures[0],y=(p.ticks-a.ticks)/u.ppq/a.timeSignature[0]/(a.timeSignature[1]/4);a.measures=a.measures||0,p.measures=y+a.measures})},l.prototype.ticksToSeconds=function(u){var d=(0,o.search)(this.tempos,u);if(d!==-1){var i=this.tempos[d],p=i.time,g=(u-i.ticks)/this.ppq;return p+60/i.bpm*g}return u/this.ppq*.5},l.prototype.ticksToMeasures=function(u){var d=(0,o.search)(this.timeSignatures,u);if(d!==-1){var i=this.timeSignatures[d],p=(u-i.ticks)/this.ppq;return i.measures+p/(i.timeSignature[0]/i.timeSignature[1])/4}return u/this.ppq/4},Object.defineProperty(l.prototype,"ppq",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),l.prototype.secondsToTicks=function(u){var d=(0,o.search)(this.tempos,u,"time");if(d!==-1){var i=this.tempos[d],p=(u-i.time)/(60/i.bpm);return Math.round(i.ticks+p*this.ppq)}var g=u/.5;return Math.round(g*this.ppq)},l.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(u){return{bpm:u.bpm,ticks:u.ticks}}),timeSignatures:this.timeSignatures}},l.prototype.fromJSON=function(u){this.name=u.name,this.tempos=u.tempos.map(function(d){return Object.assign({},d)}),this.timeSignatures=u.timeSignatures.map(function(d){return Object.assign({},d)}),this.keySignatures=u.keySignatures.map(function(d){return Object.assign({},d)}),this.meta=u.meta.map(function(d){return Object.assign({},d)}),r.set(this,u.ppq),this.update()},l.prototype.setTempo=function(u){this.tempos=[{bpm:u,ticks:0}],this.update()},l}();n.Header=e},362:(t,n,c)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.Instrument=void 0;var o=c(438),r=new WeakMap,e=function(){function l(u,d){if(this.number=0,r.set(this,d),this.number=0,u){var i=u.find(function(p){return p.type==="programChange"});i&&(this.number=i.programNumber)}}return Object.defineProperty(l.prototype,"name",{get:function(){return this.percussion?o.DrumKitByPatchID[this.number]:o.instrumentByPatchID[this.number]},set:function(u){var d=o.instrumentByPatchID.indexOf(u);d!==-1&&(this.number=d)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"family",{get:function(){return this.percussion?"drums":o.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"percussion",{get:function(){return r.get(this).channel===9},enumerable:!1,configurable:!0}),l.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},l.prototype.fromJSON=function(u){this.number=u.number},l}();n.Instrument=e},438:(t,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.DrumKitByPatchID=n.InstrumentFamilyByID=n.instrumentByPatchID=void 0,n.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],n.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],n.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},233:function(t,n,c){var o=this&&this.__awaiter||function(a,y,v,k){return new(v||(v=Promise))(function(b,M){function T(U){try{P(k.next(U))}catch(w){M(w)}}function E(U){try{P(k.throw(U))}catch(w){M(w)}}function P(U){var w;U.done?b(U.value):(w=U.value,w instanceof v?w:new v(function(S){S(w)})).then(T,E)}P((k=k.apply(a,y||[])).next())})},r=this&&this.__generator||function(a,y){var v,k,b,M,T={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return M={next:E(0),throw:E(1),return:E(2)},typeof Symbol=="function"&&(M[Symbol.iterator]=function(){return this}),M;function E(P){return function(U){return function(w){if(v)throw new TypeError("Generator is already executing.");for(;T;)try{if(v=1,k&&(b=2&w[0]?k.return:w[0]?k.throw||((b=k.return)&&b.call(k),0):k.next)&&!(b=b.call(k,w[1])).done)return b;switch(k=0,b&&(w=[2&w[0],b.value]),w[0]){case 0:case 1:b=w;break;case 4:return T.label++,{value:w[1],done:!1};case 5:T.label++,k=w[1],w=[0];continue;case 7:w=T.ops.pop(),T.trys.pop();continue;default:if(!((b=(b=T.trys).length>0&&b[b.length-1])||w[0]!==6&&w[0]!==2)){T=0;continue}if(w[0]===3&&(!b||w[1]>b[0]&&w[1]<b[3])){T.label=w[1];break}if(w[0]===6&&T.label<b[1]){T.label=b[1],b=w;break}if(b&&T.label<b[2]){T.label=b[2],T.ops.push(w);break}b[2]&&T.ops.pop(),T.trys.pop();continue}w=y.call(a,T)}catch(S){w=[6,S],k=0}finally{v=b=0}if(5&w[0])throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}([P,U])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Header=n.Track=n.Midi=void 0;var e=c(289),l=c(535),u=c(334),d=c(54),i=function(){function a(y){var v=this,k=null;if(y){var b=y instanceof ArrayBuffer?new Uint8Array(y):y;(k=(0,e.parseMidi)(b)).tracks.forEach(function(M){var T=0;M.forEach(function(E){T+=E.deltaTime,E.absoluteTime=T})}),k.tracks=function(M){for(var T=[],E=0;E<M.length;E++)for(var P=T.length,U=new Map,w=Array(16).fill(0),S=0,x=M[E];S<x.length;S++){var C=x[S],V=P,H=C.channel;if(H!==void 0){C.type==="programChange"&&(w[H]=C.programNumber);var J=w[H],_="".concat(J," ").concat(H);U.has(_)?V=U.get(_):(V=P+U.size,U.set(_,V))}T[V]||T.push([]),T[V].push(C)}return T}(k.tracks)}this.header=new l.Header(k),this.tracks=[],y&&(this.tracks=k.tracks.map(function(M){return new u.Track(M,v.header)}),k.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return a.fromUrl=function(y){return o(this,void 0,void 0,function(){var v;return r(this,function(k){switch(k.label){case 0:return[4,fetch(y)];case 1:return(v=k.sent()).ok?[4,v.arrayBuffer()]:[3,3];case 2:return[2,new a(k.sent())];case 3:throw new Error("Could not load '".concat(y,"'"))}})})},Object.defineProperty(a.prototype,"name",{get:function(){return this.header.name},set:function(y){this.header.name=y},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var y=this.tracks.map(function(v){return v.duration});return Math.max.apply(Math,y)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"durationTicks",{get:function(){var y=this.tracks.map(function(v){return v.durationTicks});return Math.max.apply(Math,y)},enumerable:!1,configurable:!0}),a.prototype.addTrack=function(){var y=new u.Track(void 0,this.header);return this.tracks.push(y),y},a.prototype.toArray=function(){return(0,d.encode)(this)},a.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(y){return y.toJSON()})}},a.prototype.fromJSON=function(y){var v=this;this.header=new l.Header,this.header.fromJSON(y.header),this.tracks=y.tracks.map(function(k){var b=new u.Track(void 0,v.header);return b.fromJSON(k),b})},a.prototype.clone=function(){var y=new a;return y.fromJSON(this.toJSON()),y},a}();n.Midi=i;var p=c(334);Object.defineProperty(n,"Track",{enumerable:!0,get:function(){return p.Track}});var g=c(535);Object.defineProperty(n,"Header",{enumerable:!0,get:function(){return g.Header}})},518:(t,n)=>{function c(d){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][d%12]}Object.defineProperty(n,"__esModule",{value:!0}),n.Note=void 0;var o,r,e=(o=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,r={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(d){var i=o.exec(d),p=i[1],g=i[2];return r[p.toLowerCase()]+12*(parseInt(g,10)+1)}),l=new WeakMap,u=function(){function d(i,p,g){l.set(this,g),this.midi=i.midi,this.velocity=i.velocity,this.noteOffVelocity=p.velocity,this.ticks=i.ticks,this.durationTicks=p.ticks-i.ticks}return Object.defineProperty(d.prototype,"name",{get:function(){return i=this.midi,p=Math.floor(i/12)-1,c(i)+p.toString();var i,p},set:function(i){this.midi=e(i)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(i){var p=i-this.octave;this.midi+=12*p},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"pitch",{get:function(){return c(this.midi)},set:function(i){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(i)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"duration",{get:function(){var i=l.get(this);return i.ticksToSeconds(this.ticks+this.durationTicks)-i.ticksToSeconds(this.ticks)},set:function(i){var p=l.get(this).secondsToTicks(this.time+i);this.durationTicks=p-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"time",{get:function(){return l.get(this).ticksToSeconds(this.ticks)},set:function(i){var p=l.get(this);this.ticks=p.secondsToTicks(i)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"bars",{get:function(){return l.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),d.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},d}();n.Note=u},882:(t,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.PitchBend=void 0;var c=new WeakMap,o=function(){function r(e,l){c.set(this,l),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(r.prototype,"time",{get:function(){return c.get(this).ticksToSeconds(this.ticks)},set:function(e){var l=c.get(this);this.ticks=l.secondsToTicks(e)},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},r}();n.PitchBend=o},334:(t,n,c)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.Track=void 0;var o=c(805),r=c(543),e=c(906),l=c(882),u=c(362),d=c(518),i=new WeakMap,p=function(){function g(a,y){var v=this;if(this.name="",this.notes=[],this.controlChanges=(0,e.createControlChanges)(),this.pitchBends=[],i.set(this,y),a){var k=a.find(function(U){return U.type==="trackName"});this.name=k?k.text:""}if(this.instrument=new u.Instrument(a,this),this.channel=0,a){for(var b=a.filter(function(U){return U.type==="noteOn"}),M=a.filter(function(U){return U.type==="noteOff"}),T=function(){var U=b.shift();E.channel=U.channel;var w=M.findIndex(function(x){return x.noteNumber===U.noteNumber&&x.absoluteTime>=U.absoluteTime});if(w!==-1){var S=M.splice(w,1)[0];E.addNote({durationTicks:S.absoluteTime-U.absoluteTime,midi:U.noteNumber,noteOffVelocity:S.velocity/127,ticks:U.absoluteTime,velocity:U.velocity/127})}},E=this;b.length;)T();a.filter(function(U){return U.type==="controller"}).forEach(function(U){v.addCC({number:U.controllerType,ticks:U.absoluteTime,value:U.value/127})}),a.filter(function(U){return U.type==="pitchBend"}).forEach(function(U){v.addPitchBend({ticks:U.absoluteTime,value:U.value/Math.pow(2,13)})});var P=a.find(function(U){return U.type==="endOfTrack"});this.endOfTrackTicks=P!==void 0?P.absoluteTime:void 0}}return g.prototype.addNote=function(a){var y=i.get(this),v=new d.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},y);return Object.assign(v,a),(0,o.insert)(this.notes,v,"ticks"),this},g.prototype.addCC=function(a){var y=i.get(this),v=new r.ControlChange({controllerType:a.number},y);return delete a.number,Object.assign(v,a),Array.isArray(this.controlChanges[v.number])||(this.controlChanges[v.number]=[]),(0,o.insert)(this.controlChanges[v.number],v,"ticks"),this},g.prototype.addPitchBend=function(a){var y=i.get(this),v=new l.PitchBend({},y);return Object.assign(v,a),(0,o.insert)(this.pitchBends,v,"ticks"),this},Object.defineProperty(g.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var a=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,y=0;y<this.notes.length-1;y++){var v=this.notes[y].time+this.notes[y].duration;a<v&&(a=v)}return a},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var a=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,y=0;y<this.notes.length-1;y++){var v=this.notes[y].ticks+this.notes[y].durationTicks;a<v&&(a=v)}return a},enumerable:!1,configurable:!0}),g.prototype.fromJSON=function(a){var y=this;for(var v in this.name=a.name,this.channel=a.channel,this.instrument=new u.Instrument(void 0,this),this.instrument.fromJSON(a.instrument),a.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=a.endOfTrackTicks),a.controlChanges)a.controlChanges[v]&&a.controlChanges[v].forEach(function(k){y.addCC({number:k.number,ticks:k.ticks,value:k.value})});a.notes.forEach(function(k){y.addNote({durationTicks:k.durationTicks,midi:k.midi,ticks:k.ticks,velocity:k.velocity})})},g.prototype.toJSON=function(){for(var a={},y=0;y<127;y++)this.controlChanges.hasOwnProperty(y)&&(a[y]=this.controlChanges[y].map(function(k){return k.toJSON()}));var v={channel:this.channel,controlChanges:a,pitchBends:this.pitchBends.map(function(k){return k.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(k){return k.toJSON()})};return this.endOfTrackTicks!==void 0&&(v.endOfTrackTicks=this.endOfTrackTicks),v},g}();n.Track=p}},m={};function s(t){var n=m[t];if(n!==void 0)return n.exports;var c=m[t]={exports:{}};return f[t].call(c.exports,c,c.exports,s),c.exports}return s.d=(t,n)=>{for(var c in n)s.o(n,c)&&!s.o(t,c)&&Object.defineProperty(t,c,{enumerable:!0,get:n[c]})},s.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),s.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s(233)})()})}(K)),K.exports}var me=Ne();let X,N,O={},F={},L={},z=!1,Fe=.66,G=.001,A=.001,se=0,ce=0,Q=1,B=[{attack:G,release:A},{volume:1}],$={},R,xe,ye,ge,Ie,ve,te,re,ne,ie,be,we,q,oe,j,Le=27.5;document.addEventListener("DOMContentLoaded",async()=>{await De(),Se(),_e(),Ve(),ze(),await $e(),Qe()});async function De(){try{const I=await fetch("harmonic-presets.json");if(!I.ok)throw new Error(`HTTP Error! Status: ${I.status}`);$=await I.json(),Ae()}catch(I){return console.error("Error loading presets: ",I),document.getElementById("harmonic-presets-container").innerHTML+='<p class="error">Failed to load presets</p>',!1}}function Ae(){const I=document.getElementById("harmonic-presets-dropdown");for(;I.options.length>1;)I.remove(1);for(const h in $){const f=document.createElement("optgroup");f.label=h;for(const m in $[h]){const s=document.createElement("option");s.value=JSON.stringify($[h][m]),s.textContent=m,f.appendChild(s)}I.appendChild(f)}I.addEventListener("change",function(){if(this.selectedIndex!==0)try{B=JSON.parse(JSON.stringify(JSON.parse(this.value))),Te(),Y()}catch{console.error("Invalid preset selection:",error)}})}function Ve(){ye=document.getElementById("harmonic-add"),ge=document.getElementById("harmonic-remove"),te=document.getElementById("harmonic-attack-slider"),re=document.getElementById("harmonic-release-slider"),Ie=document.getElementById("transpose-semitones-slider"),ve=document.getElementById("transpose-cents-slider"),ne=document.getElementById("harmonic-attack-value-label"),ie=document.getElementById("harmonic-release-value-label"),be=document.getElementById("transpose-semitones-value-label"),we=document.getElementById("transpose-cents-value-label"),xe=document.getElementById("harmonic-row"),R=document.getElementById("harmonics-container"),R.innerHTML="",Te(),ye.addEventListener("click",()=>{qe()}),ge.addEventListener("click",()=>{je()}),te.addEventListener("input",function(){G=parseFloat(this.value),ne.innerHTML=this.value}),re.addEventListener("input",function(){A=parseFloat(this.value),ie.innerHTML=this.value}),Ie.addEventListener("input",function(){se=parseInt(this.value),be.innerHTML=parseInt(this.value),ke()}),ve.addEventListener("input",function(){ce=parseInt(this.value),we.innerHTML=parseInt(this.value),ke()})}function ke(){const I={...O,...F,...L};for(const h in I){const f=I[h];f.oscillators&&f.oscillators.forEach(({oscillator:m,gainNode:s,baseFrequency:t})=>{const n=se*100+ce,c=Math.pow(2,n/1200);t*=c,m.frequency.value=t})}}function qe(){B.slice(1).length<50&&(B.push({volume:1}),ue(),Y())}function je(){B.slice(1).length>1&&(B.pop(),ue(),Y())}function Te(){R.innerHTML="",B.length>0&&B[0]&&(B[0].attack!==void 0&&(G=parseFloat(B[0].attack),te.value=G.toString(),ne.innerHTML=G.toString()),B[0].release!==void 0&&(A=parseFloat(B[0].release),re.value=A.toString(),ie.innerHTML=A.toString())),ue()}function ue(){R.innerHTML="",B.forEach((I,h)=>{if(h!==0){const f=document.importNode(xe.content,!0),m=f.querySelector(".harmonic-label");m&&(m.innerHTML=`${h}`);const s=f.querySelector(".harmonic-volume-slider");s&&(s.value=I.volume,s.dataset.index=h,s.addEventListener("input",function(){const t=parseInt(this.dataset.index);B[t].volume=this.value,Y()})),R.appendChild(f)}})}function Y(){if(Object.keys(O).length===0&&Object.keys(F).length===0)return;let I=0;for(let m=0;m<B.slice(1).length;m++){const s=parseFloat(B.slice(1)[m].volume);I+=s*s}const h=I>0?1/Math.sqrt(I):0;function f(m){const{oscillators:s,gainNode:t}=m,n=s[0].oscillator.frequency.value;for(let c=0;c<Math.min(s.length,B.slice(1).length);c++){const o=parseFloat(B.slice(1)[c].volume);s[c].gainNode.gain.value=o*h}for(let c=s.length;c<B.slice(1).length;c++){const o=parseFloat(B.slice(1)[c].volume),r=N.currentTime,e=N.createOscillator(),l=n*(c+1);e.type="sine",e.frequency.value=l*Q;const u=N.createGain();u.gain.cancelScheduledValues(r),u.gain.setValueAtTime(0,r),u.gain.linearRampToValueAtTime(o*h,r+G),e.connect(u),u.connect(t),e.start(),s.push({oscillator:e,gainNode:u,baseFrequency:l})}if(s.length>B.slice(1).length){const c=N.currentTime;for(let o=B.slice(1).length;o<s.length;o++)s[o].oscillator.stop(c+A);s.length=B.slice(1).length}le()}for(const m in O)f(O[m]);for(const m in F)f(F[m])}function Se(){let I=document.getElementById("reset-audio");N=new(window.AudioContext||window.webkitAudioContext),document.addEventListener("click",()=>{N.state==="suspended"&&N.resume()}),I.addEventListener("click",()=>{He()})}function He(){if(N){const I={...O,...F,...L};for(const h in I){const f=I[h],m=N.currentTime;f.oscillators&&f.oscillators.forEach(({oscillator:s,gainNode:t})=>{try{s.stop(m),s.disconnect(),t.disconnect()}catch(n){console.error("Error stopping oscillator:",n)}})}N.close(),Se()}}async function _e(){const I=document.querySelector(".midi-message");if(!navigator.requestMIDIAccess){I.textContent="MIDI is not supported in this browser";return}try{X=await navigator.requestMIDIAccess(),X.onstatechange=Ue,I.textContent="Waiting for MIDI Device...",Ue()}catch(h){I.textContent=`Failed to access to MIDI devices: ${h}`,console.error("MIDI Access Error:",h)}}function Ue(I){if(!X)return;const h=document.querySelector(".midi-message"),f=X.inputs;if(f.forEach(m=>{m.onmidimessage=D}),f.size>0){const m=[];f.forEach(s=>m.push(s.name)),h.textContent=`Connected to: ${m.join(", ")}`}else h.textContent="Waiting for MIDI device to connect..."}function D(I,h=!1){const f=I.data[0],m=I.data[1],s=I.data[2],t=document.querySelector(".active-notes-message");f===144&&(s>0?Ge(m,s,h):ae(m)),f===128&&ae(m),f===176&&Re(m,s),f===224&&Ke(s),t.textContent=JSON.stringify(Object.keys(O))}function le(){const I=Object.keys(O).length+Object.keys(F).length+Object.keys(L).length;if(I===0)return;const h=1/Math.sqrt(I),f=N.currentTime;for(const m in O){const{oscillators:s,gainNode:t,velocity:n}=O[m],o=n/127*Fe*h,r=t.gain.value;t.gain.cancelScheduledValues(f),t.gain.setValueAtTime(r,f),t.gain.linearRampToValueAtTime(o,f+G)}}function Je(I){const h=se*100+ce,f=Math.pow(2,h/1200);return 440*Math.pow(2,(I-69)/12)*f}function Ge(I,h,f=!1){const m={...O,...F,...L};if(Object.keys(m).length>=25)return;if(F[I]){const{oscillators:r,gainNode:e}=F[I],l=N.currentTime;e.gain.cancelScheduledValues(l),e.gain.setValueAtTime(e.gain.value,l),e.gain.linearRampToValueAtTime(0,l+A),r.forEach(({oscillator:u})=>{u.stop(l+A)}),delete F[I]}O[I]&&ae(I);let s=[],t=Je(I);const n=N.createGain();n.gain.value=0;let c=0;for(let r=0;r<B.slice(1).length;r++){const e=parseFloat(B.slice(1)[r].volume);c+=e*e}const o=c>0?1/Math.sqrt(c):0;for(let r=0;r<B.slice(1).length;r++){const e=N.createOscillator(),l=t*(r+1);e.type="sine",e.frequency.value=l*Q;const u=N.createGain();u.gain.value=B.slice(1)[r].volume*o,e.connect(u),u.connect(n),e.start(),s.push({oscillator:e,gainNode:u,baseFrequency:l})}n.connect(N.destination),O[I]={oscillators:s,gainNode:n,velocity:h,midiPlayerActivated:f},le()}function ae(I){if(O[I])if(z)F[I]=O[I],delete O[I];else{const{oscillators:h,gainNode:f}=O[I],m=N.currentTime;f.gain.cancelScheduledValues(m),f.gain.setValueAtTime(f.gain.value,m),f.gain.linearRampToValueAtTime(0,m+A),L[I]={oscillators:h,gainNode:f,releaseEnd:m+A},delete O[I],setTimeout(()=>{L[I]&&(h.forEach(({oscillator:s})=>{s.stop(m)}),delete L[I])},A*1e3),le()}}function Re(I,h){if(I===64){const f=z;z=h>=64,f&&!z&&We()}}function We(){for(const I in F){const{oscillators:h,gainNode:f}=F[I],m=N.currentTime;f.gain.cancelScheduledValues(m),f.gain.setValueAtTime(f.gain.value,m),f.gain.linearRampToValueAtTime(0,m+A),L[I]={oscillators:h,gainNode:f,releaseEnd:m+A},delete O[I],setTimeout(()=>{L[I]&&(h.forEach(({oscillator:s})=>{s.stop(m)}),delete L[I])},A*1e3)}F={}}function Ke(I){const h=I/127*4-2;Q=Math.pow(2,h/12);const f={...O,...F,...L};for(const m in f){const s=f[m];s&&s.oscillators.forEach(({oscillator:t,gainNode:n,baseFrequency:c})=>{t.frequency.value=c*Q})}}function ze(){if(q=document.getElementById("waveform-graph"),!q){console.error("Waveform graph not found");return}q.width=q.clientWidth,q.height=q.clientHeight,oe=window.getComputedStyle(q),j=q.getContext("2d"),Ee()}function Ee(){if(requestAnimationFrame(Ee),!j)return;oe.backgroundColor?j.fillStyle=oe.backgroundColor:j.fillStyle="rgb(0, 0, 0)",j.fillRect(0,0,q.width,q.height);const I={...O,...F,...L};if(Object.keys(I).length===0)return;q.width;const h=[];let f=0;for(const c in I){const o=I[c],{oscillators:r,gainNode:e}=o,l=e.gain.value;for(let u=0;u<r.length;u++){const{oscillator:d,gainNode:i}=r[u],p=d.frequency.value,g=i.gain.value*l;h.push({frequency:p,amplitude:g}),f+=g}}function m(c){let o=0;for(const r of h)o+=r.amplitude*Math.sin(2*Math.PI*r.frequency*c);return f>1?o/f:o}const s=q.width,t=q.height,n=1/Le;j.strokeStyle="rgb(0, 255, 0)",j.lineWidth=2,j.beginPath();for(let c=0;c<s;c++){const o=c/s*n,e=(1-m(o))*t/2;c==0?j.moveTo(c,e):j.lineTo(c,e)}j.stroke()}async function $e(){const I=document.getElementById("midi-player-select-dropdown"),h=document.getElementById("midi-player-upload-button"),f=document.getElementById("midi-current-file-label"),m=document.getElementById("midi-play"),s=document.getElementById("midi-loop-checkbox"),t=document.getElementById("midi-speed-control-bar"),n=document.getElementById("midi-speed-control-value"),c=document.getElementById("midi-progress-bar"),o=document.getElementById("midi-progress-fill"),r=document.getElementById("midi-progress-handle"),e=document.getElementById("midi-current-time"),l=document.getElementById("midi-total-time");let u,d=!1,i=!1,p=!1,g=1;await a(),k();async function a(){try{const b=await fetch("midi-files.json");if(!b.ok)throw new Error(`HTTP Error! Status: ${b.status}`);const M=await b.json();for(;I.options.length>1;)I.remove(1);for(const T in M){const E=document.createElement("optgroup");E.label=T;for(const P in M[T]){const U=M[T][P],w=U.name,S=U.path,x=document.createElement("option");x.value=S,x.dataset.name=w,x.textContent=w,E.appendChild(x)}I.appendChild(E)}I.addEventListener("change",async T=>{if(T.target.selectedIndex!==0)try{const E=T.target.selectedOptions[0],P=E.value,U=E.dataset.name;await y(P,U)}catch(E){console.error("Error loading MIDI file: ",E),f.innerHTML+="Error loading MIDI file"}})}catch(b){console.error("Error loading MIDI files: ",b),f.innerHTML+="Error loading MIDI files"}}h.addEventListener("change",async function(){try{const b=this.files[0];await y(b)}catch(b){console.error("Error loading MIDI file: ",b),f.innerHTML+="Error loading MIDI file"}});async function y(b,M=""){let T;try{if(typeof b=="string"){const w=await fetch(b);if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);T=await w.arrayBuffer(),f.innerHTML="MIDI File Loaded: "+M}else if(b instanceof File)T=await b.arrayBuffer(),f.innerHTML="MIDI File Loaded: "+b.name;else if(b instanceof ArrayBuffer)T=b;else throw new Error("Invalid source type. Must be a URL string, File, or ArrayBuffer");const E=new me.Midi(T),P=v(E);console.log(P);const U=Oe.parseMidi(new Uint8Array(P.toArray()));u&&(u.isPlaying&&u.pause(),u.timeoutId&&clearTimeout(u.timeoutId),m.textContent="Play",m.classList.remove("midi-playing"),u=null),u=new Xe(U,D,d,i,g,m,P),h.value="",I.selectedIndex=0,u&&(l.textContent=u.formatTime(u.getTotalTime()),e.textContent="0:00",r.style.left="0%",o.style.width="0%")}catch(E){console.error("Error loading MIDI file: ",E),f.innerHTML="Error loading MIDI file"}}function v(b){let M=new me.Midi;M.header=b.header;let T=M.addTrack();return b.tracks.forEach(E=>{T.notes.push(...E.notes),E.controlChanges&&Object.values(E.controlChanges).forEach(P=>{P.forEach(U=>{T.addCC(U)})}),E.pitchBends&&E.pitchBends.forEach(P=>{T.addPitchBend(P)})}),M}function k(){m.addEventListener("click",()=>{u&&(u.isPlaying?(m.textContent="Play",m.classList.remove("midi-playing"),d=!0,u.pause()):(m.textContent="Pause",m.classList.add("midi-playing"),d=!1,u.play()))}),s.addEventListener("change",()=>{i=s.checked,u&&u.setLooping(i)}),t.addEventListener("input",()=>{g=parseFloat(t.value),n.textContent=g.toFixed(2)+"x",u&&u.setPlaybackSpeed(g)}),c.addEventListener("mousedown",P=>{u&&(p=!0,T(P),document.addEventListener("mousemove",b),document.addEventListener("mouseup",M))});function b(P){p&&T(P)}function M(){p=!1,document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",M)}function T(P){if(!u)return;const U=c.getBoundingClientRect(),S=Math.max(0,Math.min(U.width,P.clientX-U.left))/U.width*100;r.style.left=`${S}%`,o.style.width=`${S}%`;const x=u.setPlaybackPosition(S);e.textContent=u.formatTime(x)}requestAnimationFrame(E);function E(){if(u&&u.isPlaying&&!p){const P=u.getCurrentPosition(),U=u.getProgressPercentage();e.textContent=u.formatTime(P),r.style.left=`${U}%`,o.style.width=`${U}%`}requestAnimationFrame(E)}}}class Xe{constructor(h,f,m=!1,s=!1,t=1,n=null,c=null){this.MIDIData=h,this.onMIDIEvent=f,this.isPlaying=m,this.isLooping=s,this.playbackSpeed=t,this.timeoutId=null,this.maxSimultaneousEvents=15,this.playButton=n,this.originalMIDI=c,this.activeNotes=new Set;const{processedEvents:o,tempoEvents:r}=this.preprocessEvents();this.processedEvents=o,this.tempoEvents=r,this.currentIndex=0,this.startTime=0,this.pauseTime=0,this.totalTime=this.calculateTotalTime(),console.log(this.formatTime(this.totalTime))}preprocessEvents(){if(!this.MIDIData||!this.MIDIData.tracks||this.MIDIData.tracks.length===0)return{processedEvents:[],tempoEvents:[{tick:0,tempo:5e5}]};const h=[],f=[],m=this.MIDIData.header.ticksPerBeat||480;return this.MIDIData.tracks.forEach(s=>{let t=0;s.forEach(n=>{t+=n.deltaTime,n.type==="setTempo"&&f.push({tick:t,tempo:n.microsecondsPerBeat})})}),f.sort((s,t)=>s.tick-t.tick),(f.length===0||f[0].tick>0)&&f.unshift({tick:0,tempo:5e5}),this.MIDIData.tracks.forEach((s,t)=>{let n=0;s.forEach(c=>{if(n+=c.deltaTime,["noteOn","noteOff","controller"].includes(c.type)){const o=this.ticksToMs(n,f,m);h.push({...c,absoluteTick:n,absoluteTime:o,track:t})}})}),this.originalMIDI&&this.originalMIDI.tracks.forEach((s,t)=>{s.pitchBends.forEach(n=>{const c=this.ticksToMs(n.ticks,f,m);h.push({type:"pitchBend",value:n.value,absoluteTick:n.ticks,absoluteTime:c,track:t})})}),h.sort((s,t)=>s.absoluteTick!==t.absoluteTick?s.absoluteTick-t.absoluteTick:s.type==="noteOff"&&t.type==="noteOn"?-1:s.type==="noteOn"&&t.type==="noteOff"?1:s.track-t.track),{processedEvents:h,tempoEvents:f}}ticksToMs(h,f,m){let s=0,t=0,n=f[0].tempo;for(let o=0;o<f.length;o++){const r=f[o];if(r.tick<h){const e=r.tick-t;s+=e/m*(n/1e3),t=r.tick,n=r.tempo}else break}const c=h-t;return s+=c/m*(n/1e3),s}calculateTotalTime(){return this.processedEvents.length===0?0:this.processedEvents[this.processedEvents.length-1].absoluteTime+500}formatTime(h){const f=Math.floor(h/1e3),m=Math.floor(f/60),s=f%60;return`${m}:${s.toString().padStart(2,"0")}`}play(){if(!this.isPlaying){if(this.isPlaying=!0,this.currentIndex>=this.processedEvents.length&&(this.currentIndex=0),this.pauseTime>0)this.startTime=performance.now()-this.pauseTime/this.playbackSpeed;else{const h=this.processedEvents[this.currentIndex]||{absoluteTime:0};this.startTime=performance.now()-h.absoluteTime/this.playbackSpeed,console.log(performance.now()),console.log(h.absoluteTime),console.log(this.playbackSpeed)}this.processEvents(),this.playButton&&(this.playButton.textContent="Pause",this.playButton.classList.add("midi-playing"))}}pause(){if(!this.isPlaying)return;this.pauseTime=this.getCurrentPosition(),this.isPlaying=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null);const h={data:new Uint8Array([224,0,64])};this.onMIDIEvent(h,!0),this.releaseActiveNotes(),this.playButton&&(this.playButton.textContent="Play",this.playButton.classList.contains("midi-playing")&&this.playButton.classList.remove("midi-playing"))}setLooping(h){this.isLooping=h}setPlaybackSpeed(h){h<=0&&(h=.1);const f=this.isPlaying,m=this.getCurrentPosition();f&&this.pause(),this.playbackSpeed=h,this.pauseTime=m,f&&this.play()}getTotalTime(){return this.totalTime}getCurrentPosition(){return this.isPlaying?(performance.now()-this.startTime)*this.playbackSpeed:this.currentIndex<this.processedEvents.length?this.processedEvents[this.currentIndex.absoluteTime]:this.pauseTime||0}getProgressPercentage(){return this.getCurrentPosition()/this.totalTime*100}setPlaybackPosition(h){h<0&&(h=0),h>100&&(h=100);const f=h/100*this.totalTime,m=this.isPlaying;return m&&this.pause(),this.currentIndex=this.findEventIndexByTime(f),this.pauseTime=f,m&&this.play(),f}findEventIndexByTime(h){for(let f=0;f<this.processedEvents.length;f++)if(this.processedEvents[f].absoluteTime>=h)return f;return this.processedEvents.length-1}processEvents(){if(!this.isPlaying||this.processedEvents.length===0)return;const h=this.getCurrentPosition();let f=0;for(;this.currentIndex<this.processedEvents.length&&this.processedEvents[this.currentIndex].absoluteTime<=h;){if(f<=this.maxSimultaneousEvents){const m=this.processedEvents[this.currentIndex];this.processMIDIEvent(m),f+=1}this.currentIndex++}if(this.currentIndex>=this.processedEvents.length)if(this.isLooping)this.currentIndex=0,this.startTime=performance.now(),this.pauseTime=0;else{console.log("Finished"),this.pause();return}this.timeoutId=setTimeout(()=>this.processEvents(),10)}processMIDIEvent(h){let f={};switch(h.type){case"noteOn":f={data:new Uint8Array([144,h.noteNumber,h.velocity||64])};break;case"noteOff":f={data:new Uint8Array([128,h.noteNumber,h.velocity||64])};break;case"controller":f={data:new Uint8Array([176,h.noteNumber,h.velocity||64])};break;case"pitchBend":const m=64+Math.min(64,h.value*64);console.log(m),f={data:new Uint8Array([224,0,m])};break;default:return}this.onMIDIEvent(f,!0)}releaseActiveNotes(){const h={...O,...F,...L};for(const f in h){const m=h[f];if(m.midiPlayerActivated){const s=N.currentTime;m.oscillators&&m.oscillators.forEach(({oscillator:t,gainNode:n})=>{try{t.stop(s),t.disconnect(),n.disconnect()}catch(c){console.error("Error stopping oscillator:",c)}}),m.gainNode&&(m.gainNode.gain.cancelScheduledValues(s),m.gainNode.gain.setValueAtTime(0,s),m.gainNode.disconnect()),O[f]&&delete O[f],F[f]&&delete F[f],L[f]&&delete L[f]}}}}function Qe(){let I=4,h=100,f=64,m=64,s=.3,t=null,n={1:!1,2:!1},c=!1,o=null;const r={a:0,w:1,s:2,e:3,d:4,f:5,t:6,g:7,y:8,h:9,u:10,j:11,k:12,o:13,l:14,p:15,";":16,"'":17},e={},l=document.querySelectorAll(".piano-white-key"),u=document.querySelectorAll(".piano-black-key"),d=[...l,...u],i=document.querySelector('.piano-settings-button-double[data-key="shift"]'),p=document.querySelector('.piano-settings-button[data-key="z"]'),g=document.querySelector('.piano-settings-button[data-key="x"]'),a=document.querySelector('.piano-info-label[data="octave-display"]'),y=document.querySelector('.piano-settings-button[data-key="c"]'),v=document.querySelector('.piano-settings-button[data-key="v"]'),k=document.querySelector('.piano-info-label[data="velocity-display"]'),b=document.querySelector('.piano-settings-button[data-key="1"]'),M=document.querySelector('.piano-settings-button[data-key="2"]');function T(){a&&(a.textContent=`Current Octave: ${I}`)}function E(){k&&(k.textContent=`Current Velocity: ${h}`)}function P(S){return 60+S+12*(I-4)}function U(){m=64+-n[1]*64+n[2]*64,t===null&&(t=setInterval(S,16));function S(){if(Math.abs(f-m)<1){f=m,clearInterval(t),t=null,x(f);return}f+=(m-f)*s,x(Math.round(f))}function x(C){const V={data:new Uint8Array([224,0,C])};D(V)}}function w(S,x=!0){S&&(x&&!S.classList.contains("active")?S.classList.add("active"):!x&&S.classList.contains("active")&&S.classList.remove("active"))}document.addEventListener("mousedown",()=>{c=!0}),document.addEventListener("mouseup",()=>{if(c=!1,o){const S=P(parseInt(o.dataset.note)),x={data:new Uint8Array([128,S,h])};D(x),o=null}}),d.forEach(S=>{S.addEventListener("mousedown",()=>{const x=P(parseInt(S.dataset.note));o=S;const C={data:new Uint8Array([144,x,h])};D(C),w(S,!0)}),S.addEventListener("mouseenter",()=>{if(c){const x=P(parseInt(S.dataset.note));o=S;const C={data:new Uint8Array([144,x,h])};D(C),w(S,!0)}}),S.addEventListener("mouseleave",()=>{if(c){const x=P(parseInt(S.dataset.note));o=S;const C={data:new Uint8Array([128,x,h])};o=null,D(C),w(S,!1)}}),S.addEventListener("mouseup",()=>{const x=P(parseInt(S.dataset.note));o=S;const C={data:new Uint8Array([128,x,h])};D(C),w(S,!1)})}),i.addEventListener("mousedown",()=>{const S={data:new Uint8Array([176,64,127])};D(S),w(i,!0)}),i.addEventListener("mouseup",()=>{const S={data:new Uint8Array([176,64,0])};D(S),w(i,!1)}),p.addEventListener("mousedown",()=>{I>0&&(I--,T()),w(p,!0)}),p.addEventListener("mouseup",()=>{w(p,!1)}),g.addEventListener("mousedown",()=>{I<7&&(I++,T()),w(g,!0)}),g.addEventListener("mouseup",()=>{w(g,!1)}),y.addEventListener("mousedown",()=>{h>1&&(h=Math.max(1,h-5),E()),w(y,!0)}),y.addEventListener("mouseup",()=>{w(y,!1)}),v.addEventListener("mousedown",()=>{h<128&&(h=Math.min(127,h+5),E()),w(v,!0)}),v.addEventListener("mouseup",()=>{w(v,!1)}),b.addEventListener("mousedown",()=>{n[1]=!0,U(),w(b,!0)}),b.addEventListener("mouseup",()=>{n[1]=!1,U(),w(b,!1)}),M.addEventListener("mousedown",()=>{n[2]=!0,U(),w(M,!0)}),M.addEventListener("mouseup",()=>{n[2]=!1,U(),w(M,!1)}),document.addEventListener("keydown",S=>{let x=S.key.toLowerCase();if(x==="!"&&(x="1"),x==="@"&&(x="2"),x==="shift"){const C={data:new Uint8Array([176,64,127])};D(C),w(i,!0)}if(x==="z"&&(I>0&&(I--,T()),w(p,!0)),x==="x"&&(I<7&&(I++,T()),w(g,!0)),x==="c"&&(h>1&&(h=Math.max(1,h-5),E()),w(y,!0)),x==="v"&&(h<128&&(h=Math.min(127,h+5),E()),w(v,!0)),x==="1"&&(n[1]=!0,U(),w(b,!0)),x==="2"&&(n[2]=!0,U(),w(M,!0)),r[x]!==void 0){const C=r[x],V=P(C),H=Array.from(d).find(J=>{const _=J.querySelector(".key-label");return _&&_.textContent.toLowerCase()===x});if(H&&w(H,!0),!e[x]){e[x]=V;const J={data:new Uint8Array([144,V,h])};D(J)}}}),document.addEventListener("keyup",S=>{let x=S.key.toLowerCase();if(x==="!"&&(x="1"),x==="@"&&(x="2"),x==="shift"){const C={data:new Uint8Array([176,64,0])};D(C),w(i,!1)}if(x==="z"&&w(p,!1),x==="x"&&w(g,!1),x==="c"&&w(y,!1),x==="v"&&w(v,!1),x==="1"&&(n[1]=!1,U(),w(b,!1)),x==="2"&&(n[2]=!1,U(),w(M,!1)),r[x]!==void 0&&e[x]){const C=e[x],V=Array.from(d).find(J=>{const _=J.querySelector(".key-label");return _&&_.textContent.toLowerCase()===x});V&&w(V,!1);const H={data:new Uint8Array([128,C,h])};D(H),delete e[x]}})}
