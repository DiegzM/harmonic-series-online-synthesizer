(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function i(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(t){if(t.ep)return;t.ep=!0;const e=i(t);fetch(t.href,e)}})();function et(o){if(Object.prototype.hasOwnProperty.call(o,"__esModule"))return o;var s=o.default;if(typeof s=="function"){var i=function a(){return this instanceof a?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};i.prototype=s.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(o).forEach(function(a){var t=Object.getOwnPropertyDescriptor(o,a);Object.defineProperty(i,a,t.get?t:{enumerable:!0,get:function(){return o[a]}})}),i}var te={},se,we;function tt(){if(we)return se;we=1;function o(t){var e=new a(t),n=e.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var u=s(n.data),l=[],c=0;!e.eof()&&c<u.numTracks;c++){var r=e.readChunk();if(r.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+r.id+"'";var f=i(r.data);l.push(f)}return{header:u,tracks:l}}function s(t){var e=new a(t),n=e.readUInt16(),u=e.readUInt16(),l={format:n,numTracks:u},c=e.readUInt16();return c&32768?(l.framesPerSecond=256-(c>>8),l.ticksPerFrame=c&255):l.ticksPerBeat=c,l}function i(t){for(var e=new a(t),n=[];!e.eof();){var u=c();n.push(u)}return n;var l;function c(){var r={};r.deltaTime=e.readVarInt();var f=e.readUInt8();if((f&240)===240)if(f===255){r.meta=!0;var d=e.readUInt8(),h=e.readVarInt();switch(d){case 0:if(r.type="sequenceNumber",h!==2)throw"Expected length for sequenceNumber event is 2, got "+h;return r.number=e.readUInt16(),r;case 1:return r.type="text",r.text=e.readString(h),r;case 2:return r.type="copyrightNotice",r.text=e.readString(h),r;case 3:return r.type="trackName",r.text=e.readString(h),r;case 4:return r.type="instrumentName",r.text=e.readString(h),r;case 5:return r.type="lyrics",r.text=e.readString(h),r;case 6:return r.type="marker",r.text=e.readString(h),r;case 7:return r.type="cuePoint",r.text=e.readString(h),r;case 32:if(r.type="channelPrefix",h!=1)throw"Expected length for channelPrefix event is 1, got "+h;return r.channel=e.readUInt8(),r;case 33:if(r.type="portPrefix",h!=1)throw"Expected length for portPrefix event is 1, got "+h;return r.port=e.readUInt8(),r;case 47:if(r.type="endOfTrack",h!=0)throw"Expected length for endOfTrack event is 0, got "+h;return r;case 81:if(r.type="setTempo",h!=3)throw"Expected length for setTempo event is 3, got "+h;return r.microsecondsPerBeat=e.readUInt24(),r;case 84:if(r.type="smpteOffset",h!=5)throw"Expected length for smpteOffset event is 5, got "+h;var T=e.readUInt8(),k={0:24,32:25,64:29,96:30};return r.frameRate=k[T&96],r.hour=T&31,r.min=e.readUInt8(),r.sec=e.readUInt8(),r.frame=e.readUInt8(),r.subFrame=e.readUInt8(),r;case 88:if(r.type="timeSignature",h!=2&&h!=4)throw"Expected length for timeSignature event is 4 or 2, got "+h;return r.numerator=e.readUInt8(),r.denominator=1<<e.readUInt8(),h===4?(r.metronome=e.readUInt8(),r.thirtyseconds=e.readUInt8()):(r.metronome=36,r.thirtyseconds=8),r;case 89:if(r.type="keySignature",h!=2)throw"Expected length for keySignature event is 2, got "+h;return r.key=e.readInt8(),r.scale=e.readUInt8(),r;case 127:return r.type="sequencerSpecific",r.data=e.readBytes(h),r;default:return r.type="unknownMeta",r.data=e.readBytes(h),r.metatypeByte=d,r}}else if(f==240){r.type="sysEx";var h=e.readVarInt();return r.data=e.readBytes(h),r}else if(f==247){r.type="endSysEx";var h=e.readVarInt();return r.data=e.readBytes(h),r}else throw"Unrecognised MIDI event type byte: "+f;else{var y;if((f&128)===0){if(l===null)throw"Running status byte encountered before status byte";y=f,f=l,r.running=!0}else y=e.readUInt8(),l=f;var p=f>>4;switch(r.channel=f&15,p){case 8:return r.type="noteOff",r.noteNumber=y,r.velocity=e.readUInt8(),r;case 9:var v=e.readUInt8();return r.type=v===0?"noteOff":"noteOn",r.noteNumber=y,r.velocity=v,v===0&&(r.byte9=!0),r;case 10:return r.type="noteAftertouch",r.noteNumber=y,r.amount=e.readUInt8(),r;case 11:return r.type="controller",r.controllerType=y,r.value=e.readUInt8(),r;case 12:return r.type="programChange",r.programNumber=y,r;case 13:return r.type="channelAftertouch",r.amount=y,r;case 14:return r.type="pitchBend",r.value=y+(e.readUInt8()<<7)-8192,r;default:throw"Unrecognised MIDI event type: "+p}}}}function a(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}return a.prototype.eof=function(){return this.pos>=this.bufferLen},a.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t},a.prototype.readInt8=function(){var t=this.readUInt8();return t&128?t-256:t},a.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e},a.prototype.readInt16=function(){var t=this.readUInt16();return t&32768?t-65536:t},a.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n},a.prototype.readInt24=function(){var t=this.readUInt24();return t&8388608?t-16777216:t},a.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),u=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+u},a.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e},a.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)},a.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(e&128)t+=e&127,t<<=7;else return t+e}return t},a.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}},se=o,se}var ce,xe;function nt(){if(xe)return ce;xe=1;function o(e,n){if(typeof e!="object")throw"Invalid MIDI data";n=n||{};var u=e.header||{},l=e.tracks||[],c,r=l.length,f=new t;for(s(f,u,r),c=0;c<r;c++)i(f,l[c],n);return f.buffer}function s(e,n,u){var l=n.format==null?1:n.format,c=128;n.timeDivision?c=n.timeDivision:n.ticksPerFrame&&n.framesPerSecond?c=-(n.framesPerSecond&255)<<8|n.ticksPerFrame&255:n.ticksPerBeat&&(c=n.ticksPerBeat&32767);var r=new t;r.writeUInt16(l),r.writeUInt16(u),r.writeUInt16(c),e.writeChunk("MThd",r.buffer)}function i(e,n,u){var l=new t,c,r=n.length,f=null;for(c=0;c<r;c++)(u.running===!1||!u.running&&!n[c].running)&&(f=null),f=a(l,n[c],f,u.useByte9ForNoteOff);e.writeChunk("MTrk",l.buffer)}function a(e,n,u,l){var c=n.type,r=n.deltaTime,f=n.text||"",d=n.data||[],h=null;switch(e.writeVarInt(r),c){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(n.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(f.length),e.writeString(f);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(f.length),e.writeString(f);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(f.length),e.writeString(f);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(f.length),e.writeString(f);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(f.length),e.writeString(f);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(f.length),e.writeString(f);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(f.length),e.writeString(f);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(n.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(n.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(n.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var T={24:0,25:32,29:64,30:96},k=n.hour&31|T[n.frameRate];e.writeUInt8(k),e.writeUInt8(n.min),e.writeUInt8(n.sec),e.writeUInt8(n.frame),e.writeUInt8(n.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(n.numerator);var y=Math.floor(Math.log(n.denominator)/Math.LN2)&255;e.writeUInt8(y),e.writeUInt8(n.metronome),e.writeUInt8(n.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(n.key),e.writeUInt8(n.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(d.length),e.writeBytes(d);break;case"unknownMeta":n.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(n.metatypeByte),e.writeVarInt(d.length),e.writeBytes(d));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(d.length),e.writeBytes(d);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(d.length),e.writeBytes(d);break;case"noteOff":var p=l!==!1&&n.byte9||l&&n.velocity==0?144:128;h=p|n.channel,h!==u&&e.writeUInt8(h),e.writeUInt8(n.noteNumber),e.writeUInt8(n.velocity);break;case"noteOn":h=144|n.channel,h!==u&&e.writeUInt8(h),e.writeUInt8(n.noteNumber),e.writeUInt8(n.velocity);break;case"noteAftertouch":h=160|n.channel,h!==u&&e.writeUInt8(h),e.writeUInt8(n.noteNumber),e.writeUInt8(n.amount);break;case"controller":h=176|n.channel,h!==u&&e.writeUInt8(h),e.writeUInt8(n.controllerType),e.writeUInt8(n.value);break;case"programChange":h=192|n.channel,h!==u&&e.writeUInt8(h),e.writeUInt8(n.programNumber);break;case"channelAftertouch":h=208|n.channel,h!==u&&e.writeUInt8(h),e.writeUInt8(n.amount);break;case"pitchBend":h=224|n.channel,h!==u&&e.writeUInt8(h);var v=8192+n.value,I=v&127,m=v>>7&127;e.writeUInt8(I),e.writeUInt8(m);break;default:throw"Unrecognized event type: "+c}return h}function t(){this.buffer=[]}return t.prototype.writeUInt8=function(e){this.buffer.push(e&255)},t.prototype.writeInt8=t.prototype.writeUInt8,t.prototype.writeUInt16=function(e){var n=e>>8&255,u=e&255;this.writeUInt8(n),this.writeUInt8(u)},t.prototype.writeInt16=t.prototype.writeUInt16,t.prototype.writeUInt24=function(e){var n=e>>16&255,u=e>>8&255,l=e&255;this.writeUInt8(n),this.writeUInt8(u),this.writeUInt8(l)},t.prototype.writeInt24=t.prototype.writeUInt24,t.prototype.writeUInt32=function(e){var n=e>>24&255,u=e>>16&255,l=e>>8&255,c=e&255;this.writeUInt8(n),this.writeUInt8(u),this.writeUInt8(l),this.writeUInt8(c)},t.prototype.writeInt32=t.prototype.writeUInt32,t.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},t.prototype.writeString=function(e){var n,u=e.length,l=[];for(n=0;n<u;n++)l.push(e.codePointAt(n));this.writeBytes(l)},t.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var n=e,u=[];for(u.push(n&127),n>>=7;n;){var l=n&127|128;u.push(l),n>>=7}this.writeBytes(u.reverse())}},t.prototype.writeChunk=function(e,n){this.writeString(e),this.writeUInt32(n.length),this.writeBytes(n)},ce=o,ce}var Ee;function ve(){return Ee||(Ee=1,te.parseMidi=tt(),te.writeMidi=nt()),te}var rt=ve(),H={},ue={},R={},Me;function We(){if(Me)return R;Me=1,Object.defineProperty(R,"__esModule",{value:!0}),R.insert=R.search=void 0;function o(i,a,t){t===void 0&&(t="ticks");var e=0,n=i.length,u=n;if(n>0&&i[n-1][t]<=a)return n-1;for(;e<u;){var l=Math.floor(e+(u-e)/2),c=i[l],r=i[l+1];if(c[t]===a){for(var f=l;f<i.length;f++){var d=i[f];d[t]===a&&(l=f)}return l}else{if(c[t]<a&&r[t]>a)return l;c[t]>a?u=l:c[t]<a&&(e=l+1)}}return-1}R.search=o;function s(i,a,t){if(t===void 0&&(t="ticks"),i.length){var e=o(i,a[t],t);i.splice(e+1,0,a)}else i.push(a)}return R.insert=s,R}var Se;function de(){return Se||(Se=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.Header=o.keySignatureKeys=void 0;var s=We(),i=new WeakMap;o.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var a=function(){function t(e){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",i.set(this,480),e){i.set(this,e.header.ticksPerBeat),e.tracks.forEach(function(l){l.forEach(function(c){c.meta&&(c.type==="timeSignature"?n.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?n.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&n.keySignatures.push({key:o.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var u=0;e.tracks[0].forEach(function(l){u+=l.deltaTime,l.meta&&(l.type==="trackName"?n.name=l.text:(l.type==="text"||l.type==="cuePoint"||l.type==="marker"||l.type==="lyrics")&&n.meta.push({text:l.text,ticks:u,type:l.type}))}),this.update()}}return t.prototype.update=function(){var e=this,n=0,u=0;this.tempos.sort(function(l,c){return l.ticks-c.ticks}),this.tempos.forEach(function(l,c){var r=c>0?e.tempos[c-1].bpm:e.tempos[0].bpm,f=l.ticks/e.ppq-u,d=60/r*f;l.time=d+n,n=l.time,u+=f}),this.timeSignatures.sort(function(l,c){return l.ticks-c.ticks}),this.timeSignatures.forEach(function(l,c){var r=c>0?e.timeSignatures[c-1]:e.timeSignatures[0],f=(l.ticks-r.ticks)/e.ppq,d=f/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,l.measures=d+r.measures})},t.prototype.ticksToSeconds=function(e){var n=(0,s.search)(this.tempos,e);if(n!==-1){var u=this.tempos[n],l=u.time,c=(e-u.ticks)/this.ppq;return l+60/u.bpm*c}else{var r=e/this.ppq;return 60/120*r}},t.prototype.ticksToMeasures=function(e){var n=(0,s.search)(this.timeSignatures,e);if(n!==-1){var u=this.timeSignatures[n],l=(e-u.ticks)/this.ppq;return u.measures+l/(u.timeSignature[0]/u.timeSignature[1])/4}else return e/this.ppq/4},Object.defineProperty(t.prototype,"ppq",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),t.prototype.secondsToTicks=function(e){var n=(0,s.search)(this.tempos,e,"time");if(n!==-1){var u=this.tempos[n],l=u.time,c=e-l,r=c/(60/u.bpm);return Math.round(u.ticks+r*this.ppq)}else{var f=e/.5;return Math.round(f*this.ppq)}},t.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},t.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(n){return Object.assign({},n)}),this.timeSignatures=e.timeSignatures.map(function(n){return Object.assign({},n)}),this.keySignatures=e.keySignatures.map(function(n){return Object.assign({},n)}),this.meta=e.meta.map(function(n){return Object.assign({},n)}),i.set(this,e.ppq),this.update()},t.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},t}();o.Header=a}(ue)),ue}var K={},le={},Ce;function Ke(){return Ce||(Ce=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.ControlChange=o.controlChangeIds=o.controlChangeNames=void 0,o.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},o.controlChangeIds=Object.keys(o.controlChangeNames).reduce(function(t,e){return t[o.controlChangeNames[e]]=e,t},{});var s=new WeakMap,i=new WeakMap,a=function(){function t(e,n){s.set(this,n),i.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(t.prototype,"number",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return o.controlChangeNames[this.number]?o.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var e=s.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var n=s.get(this);this.ticks=n.secondsToTicks(e)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},t}();o.ControlChange=a}(le)),le}var z={},Ue;function it(){if(Ue)return z;Ue=1,Object.defineProperty(z,"__esModule",{value:!0}),z.createControlChanges=void 0;var o=Ke();function s(){return new Proxy({},{get:function(i,a){if(i[a])return i[a];if(o.controlChangeIds.hasOwnProperty(a))return i[o.controlChangeIds[a]]},set:function(i,a,t){return o.controlChangeIds.hasOwnProperty(a)?i[o.controlChangeIds[a]]=t:i[a]=t,!0}})}return z.createControlChanges=s,z}var Q={},Pe;function at(){if(Pe)return Q;Pe=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.PitchBend=void 0;var o=new WeakMap,s=function(){function i(a,t){o.set(this,t),this.ticks=a.absoluteTime,this.value=a.value}return Object.defineProperty(i.prototype,"time",{get:function(){var a=o.get(this);return a.ticksToSeconds(this.ticks)},set:function(a){var t=o.get(this);this.ticks=t.secondsToTicks(a)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},i}();return Q.PitchBend=s,Q}var X={},V={},Be;function ot(){return Be||(Be=1,Object.defineProperty(V,"__esModule",{value:!0}),V.DrumKitByPatchID=V.InstrumentFamilyByID=V.instrumentByPatchID=void 0,V.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],V.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],V.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),V}var Oe;function st(){if(Oe)return X;Oe=1,Object.defineProperty(X,"__esModule",{value:!0}),X.Instrument=void 0;var o=ot(),s=new WeakMap,i=function(){function a(t,e){if(this.number=0,s.set(this,e),this.number=0,t){var n=t.find(function(u){return u.type==="programChange"});n&&(this.number=n.programNumber)}}return Object.defineProperty(a.prototype,"name",{get:function(){return this.percussion?o.DrumKitByPatchID[this.number]:o.instrumentByPatchID[this.number]},set:function(t){var e=o.instrumentByPatchID.indexOf(t);e!==-1&&(this.number=e)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"family",{get:function(){return this.percussion?"drums":o.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"percussion",{get:function(){var t=s.get(this);return t.channel===9},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},a.prototype.fromJSON=function(t){this.number=t.number},a}();return X.Instrument=i,X}var Y={},Ne;function ct(){if(Ne)return Y;Ne=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.Note=void 0;function o(n){var u=Math.floor(n/12)-1;return s(n)+u.toString()}function s(n){var u=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=n%12;return u[l]}function i(n){var u=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return u.indexOf(n)}var a=function(){var n=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,u={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(l){var c=n.exec(l),r=c[1],f=c[2],d=u[r.toLowerCase()];return d+(parseInt(f,10)+1)*12}}(),t=new WeakMap,e=function(){function n(u,l,c){t.set(this,c),this.midi=u.midi,this.velocity=u.velocity,this.noteOffVelocity=l.velocity,this.ticks=u.ticks,this.durationTicks=l.ticks-u.ticks}return Object.defineProperty(n.prototype,"name",{get:function(){return o(this.midi)},set:function(u){this.midi=a(u)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(u){var l=u-this.octave;this.midi+=l*12},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"pitch",{get:function(){return s(this.midi)},set:function(u){this.midi=12*(this.octave+1)+i(u)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){var u=t.get(this);return u.ticksToSeconds(this.ticks+this.durationTicks)-u.ticksToSeconds(this.ticks)},set:function(u){var l=t.get(this),c=l.secondsToTicks(this.time+u);this.durationTicks=c-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var u=t.get(this);return u.ticksToSeconds(this.ticks)},set:function(u){var l=t.get(this);this.ticks=l.secondsToTicks(u)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bars",{get:function(){var u=t.get(this);return u.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},n}();return Y.Note=e,Y}var Fe;function Le(){if(Fe)return K;Fe=1,Object.defineProperty(K,"__esModule",{value:!0}),K.Track=void 0;var o=We(),s=Ke(),i=it(),a=at(),t=st(),e=ct(),n=new WeakMap,u=function(){function l(c,r){var f=this;if(this.name="",this.notes=[],this.controlChanges=(0,i.createControlChanges)(),this.pitchBends=[],n.set(this,r),c){var d=c.find(function(m){return m.type==="trackName"});this.name=d?d.text:""}if(this.instrument=new t.Instrument(c,this),this.channel=0,c){for(var h=c.filter(function(m){return m.type==="noteOn"}),T=c.filter(function(m){return m.type==="noteOff"}),k=function(){var m=h.shift();y.channel=m.channel;var g=T.findIndex(function(M){return M.noteNumber===m.noteNumber&&M.absoluteTime>=m.absoluteTime});if(g!==-1){var E=T.splice(g,1)[0];y.addNote({durationTicks:E.absoluteTime-m.absoluteTime,midi:m.noteNumber,noteOffVelocity:E.velocity/127,ticks:m.absoluteTime,velocity:m.velocity/127})}},y=this;h.length;)k();var p=c.filter(function(m){return m.type==="controller"});p.forEach(function(m){f.addCC({number:m.controllerType,ticks:m.absoluteTime,value:m.value/127})});var v=c.filter(function(m){return m.type==="pitchBend"});v.forEach(function(m){f.addPitchBend({ticks:m.absoluteTime,value:m.value/Math.pow(2,13)})});var I=c.find(function(m){return m.type==="endOfTrack"});this.endOfTrackTicks=I!==void 0?I.absoluteTime:void 0}}return l.prototype.addNote=function(c){var r=n.get(this),f=new e.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(f,c),(0,o.insert)(this.notes,f,"ticks"),this},l.prototype.addCC=function(c){var r=n.get(this),f=new s.ControlChange({controllerType:c.number},r);return delete c.number,Object.assign(f,c),Array.isArray(this.controlChanges[f.number])||(this.controlChanges[f.number]=[]),(0,o.insert)(this.controlChanges[f.number],f,"ticks"),this},l.prototype.addPitchBend=function(c){var r=n.get(this),f=new a.PitchBend({},r);return Object.assign(f,c),(0,o.insert)(this.pitchBends,f,"ticks"),this},Object.defineProperty(l.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var c=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,r=0;r<this.notes.length-1;r++){var f=this.notes[r].time+this.notes[r].duration;c<f&&(c=f)}return c},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var c=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,r=0;r<this.notes.length-1;r++){var f=this.notes[r].ticks+this.notes[r].durationTicks;c<f&&(c=f)}return c},enumerable:!1,configurable:!0}),l.prototype.fromJSON=function(c){var r=this;this.name=c.name,this.channel=c.channel,this.instrument=new t.Instrument(void 0,this),this.instrument.fromJSON(c.instrument),c.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=c.endOfTrackTicks);for(var f in c.controlChanges)c.controlChanges[f]&&c.controlChanges[f].forEach(function(d){r.addCC({number:d.number,ticks:d.ticks,value:d.value})});c.notes.forEach(function(d){r.addNote({durationTicks:d.durationTicks,midi:d.midi,ticks:d.ticks,velocity:d.velocity})})},l.prototype.toJSON=function(){for(var c={},r=0;r<127;r++)this.controlChanges.hasOwnProperty(r)&&(c[r]=this.controlChanges[r].map(function(d){return d.toJSON()}));var f={channel:this.channel,controlChanges:c,pitchBends:this.pitchBends.map(function(d){return d.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(d){return d.toJSON()})};return this.endOfTrackTicks!==void 0&&(f.endOfTrackTicks=this.endOfTrackTicks),f},l}();return K.Track=u,K}var J={};function ut(o){var s=[];return ze(o,s),s}function ze(o,s){for(var i=0;i<o.length;i++){var a=o[i];Array.isArray(a)?ze(a,s):s.push(a)}}const lt=Object.freeze(Object.defineProperty({__proto__:null,flatten:ut},Symbol.toStringTag,{value:"Module"})),dt=et(lt);var qe;function ft(){if(qe)return J;qe=1;var o=J&&J.__spreadArray||function(p,v,I){if(I||arguments.length===2)for(var m=0,g=v.length,E;m<g;m++)(E||!(m in v))&&(E||(E=Array.prototype.slice.call(v,0,m)),E[m]=v[m]);return p.concat(E||Array.prototype.slice.call(v))};Object.defineProperty(J,"__esModule",{value:!0}),J.encode=void 0;var s=ve(),i=de(),a=dt;function t(p,v){return[{absoluteTime:p.ticks,channel:v,deltaTime:0,noteNumber:p.midi,type:"noteOn",velocity:Math.floor(p.velocity*127)},{absoluteTime:p.ticks+p.durationTicks,channel:v,deltaTime:0,noteNumber:p.midi,type:"noteOff",velocity:Math.floor(p.noteOffVelocity*127)}]}function e(p){return(0,a.flatten)(p.notes.map(function(v){return t(v,p.channel)}))}function n(p,v){return{absoluteTime:p.ticks,channel:v,controllerType:p.number,deltaTime:0,type:"controller",value:Math.floor(p.value*127)}}function u(p){for(var v=[],I=0;I<127;I++)p.controlChanges.hasOwnProperty(I)&&p.controlChanges[I].forEach(function(m){v.push(n(m,p.channel))});return v}function l(p,v){return{absoluteTime:p.ticks,channel:v,deltaTime:0,type:"pitchBend",value:p.value}}function c(p){var v=[];return p.pitchBends.forEach(function(I){v.push(l(I,p.channel))}),v}function r(p){return{absoluteTime:0,channel:p.channel,deltaTime:0,programNumber:p.instrument.number,type:"programChange"}}function f(p){return{absoluteTime:0,deltaTime:0,meta:!0,text:p,type:"trackName"}}function d(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/p.bpm),type:"setTempo"}}function h(p){return{absoluteTime:p.ticks,deltaTime:0,denominator:p.timeSignature[1],meta:!0,metronome:24,numerator:p.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function T(p){var v=i.keySignatureKeys.indexOf(p.key);return{absoluteTime:p.ticks,deltaTime:0,key:v+7,meta:!0,scale:p.scale==="major"?0:1,type:"keySignature"}}function k(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,text:p.text,type:p.type}}function y(p){var v={header:{format:1,numTracks:p.tracks.length+1,ticksPerBeat:p.header.ppq},tracks:o([o(o(o(o([{absoluteTime:0,deltaTime:0,meta:!0,text:p.header.name,type:"trackName"}],p.header.keySignatures.map(function(I){return T(I)}),!0),p.header.meta.map(function(I){return k(I)}),!0),p.header.tempos.map(function(I){return d(I)}),!0),p.header.timeSignatures.map(function(I){return h(I)}),!0)],p.tracks.map(function(I){return o(o(o([f(I.name),r(I)],e(I),!0),u(I),!0),c(I),!0)}),!0)};return v.tracks=v.tracks.map(function(I){I=I.sort(function(g,E){return g.absoluteTime-E.absoluteTime});var m=0;return I.forEach(function(g){g.deltaTime=g.absoluteTime-m,m=g.absoluteTime,delete g.absoluteTime}),I.push({deltaTime:0,meta:!0,type:"endOfTrack"}),I}),new Uint8Array((0,s.writeMidi)(v))}return J.encode=y,J}var De;function ht(){return De||(De=1,function(o){var s=H&&H.__awaiter||function(f,d,h,T){function k(y){return y instanceof h?y:new h(function(p){p(y)})}return new(h||(h=Promise))(function(y,p){function v(g){try{m(T.next(g))}catch(E){p(E)}}function I(g){try{m(T.throw(g))}catch(E){p(E)}}function m(g){g.done?y(g.value):k(g.value).then(v,I)}m((T=T.apply(f,d||[])).next())})},i=H&&H.__generator||function(f,d){var h={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},T,k,y,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(m){return function(g){return I([m,g])}}function I(m){if(T)throw new TypeError("Generator is already executing.");for(;h;)try{if(T=1,k&&(y=m[0]&2?k.return:m[0]?k.throw||((y=k.return)&&y.call(k),0):k.next)&&!(y=y.call(k,m[1])).done)return y;switch(k=0,y&&(m=[m[0]&2,y.value]),m[0]){case 0:case 1:y=m;break;case 4:return h.label++,{value:m[1],done:!1};case 5:h.label++,k=m[1],m=[0];continue;case 7:m=h.ops.pop(),h.trys.pop();continue;default:if(y=h.trys,!(y=y.length>0&&y[y.length-1])&&(m[0]===6||m[0]===2)){h=0;continue}if(m[0]===3&&(!y||m[1]>y[0]&&m[1]<y[3])){h.label=m[1];break}if(m[0]===6&&h.label<y[1]){h.label=y[1],y=m;break}if(y&&h.label<y[2]){h.label=y[2],h.ops.push(m);break}y[2]&&h.ops.pop(),h.trys.pop();continue}m=d.call(f,h)}catch(g){m=[6,g],k=0}finally{T=y=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.Header=o.Track=o.Midi=void 0;var a=ve(),t=de(),e=Le(),n=ft(),u=function(){function f(d){var h=this,T=null;if(d){var k=d instanceof ArrayBuffer?new Uint8Array(d):d;T=(0,a.parseMidi)(k),T.tracks.forEach(function(y){var p=0;y.forEach(function(v){p+=v.deltaTime,v.absoluteTime=p})}),T.tracks=r(T.tracks)}this.header=new t.Header(T),this.tracks=[],d&&(this.tracks=T.tracks.map(function(y){return new e.Track(y,h.header)}),T.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return f.fromUrl=function(d){return s(this,void 0,void 0,function(){var h,T;return i(this,function(k){switch(k.label){case 0:return[4,fetch(d)];case 1:return h=k.sent(),h.ok?[4,h.arrayBuffer()]:[3,3];case 2:return T=k.sent(),[2,new f(T)];case 3:throw new Error("Could not load '".concat(d,"'"))}})})},Object.defineProperty(f.prototype,"name",{get:function(){return this.header.name},set:function(d){this.header.name=d},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"duration",{get:function(){var d=this.tracks.map(function(h){return h.duration});return Math.max.apply(Math,d)},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"durationTicks",{get:function(){var d=this.tracks.map(function(h){return h.durationTicks});return Math.max.apply(Math,d)},enumerable:!1,configurable:!0}),f.prototype.addTrack=function(){var d=new e.Track(void 0,this.header);return this.tracks.push(d),d},f.prototype.toArray=function(){return(0,n.encode)(this)},f.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(d){return d.toJSON()})}},f.prototype.fromJSON=function(d){var h=this;this.header=new t.Header,this.header.fromJSON(d.header),this.tracks=d.tracks.map(function(T){var k=new e.Track(void 0,h.header);return k.fromJSON(T),k})},f.prototype.clone=function(){var d=new f;return d.fromJSON(this.toJSON()),d},f}();o.Midi=u;var l=Le();Object.defineProperty(o,"Track",{enumerable:!0,get:function(){return l.Track}});var c=de();Object.defineProperty(o,"Header",{enumerable:!0,get:function(){return c.Header}});function r(f){for(var d=[],h=0;h<f.length;h++)for(var T=d.length,k=new Map,y=Array(16).fill(0),p=0,v=f[h];p<v.length;p++){var I=v[p],m=T,g=I.channel;if(g!==void 0){I.type==="programChange"&&(y[g]=I.programNumber);var E=y[g],M="".concat(E," ").concat(g);k.has(M)?m=k.get(M):(m=T+k.size,k.set(M,m))}d[m]||d.push([]),d[m].push(I)}return d}}(H)),H}var Ae=ht();let ie,O,B={},N={},L={},ne=!1,mt=.66,$=.001,D=.001,be=0,Ie=0,ae=1,C=[{attack:$,release:D},{volume:1}],re={},Z,Qe,_e,Ve,je,He,fe,he,me,pe,Re,Je,A,ye,_,pt=27.5;document.addEventListener("DOMContentLoaded",async()=>{await yt(),Ye(),Tt(),vt(),Ct(),await Ut(),Bt()});async function yt(){try{const o=await fetch("harmonic-presets.json");if(!o.ok)throw new Error(`HTTP Error! Status: ${o.status}`);re=await o.json(),gt()}catch(o){return console.error("Error loading presets: ",o),document.getElementById("harmonic-presets-container").innerHTML+='<p class="error">Failed to load presets</p>',!1}}function gt(){const o=document.getElementById("harmonic-presets-dropdown");for(;o.options.length>1;)o.remove(1);for(const s in re){const i=document.createElement("optgroup");i.label=s;for(const a in re[s]){const t=document.createElement("option");t.value=JSON.stringify(re[s][a]),t.textContent=a,i.appendChild(t)}o.appendChild(i)}o.addEventListener("change",function(){if(this.selectedIndex!==0)try{C=JSON.parse(JSON.stringify(JSON.parse(this.value))),Xe(),oe()}catch{console.error("Invalid preset selection:",error)}})}function vt(){_e=document.getElementById("harmonic-add"),Ve=document.getElementById("harmonic-remove"),fe=document.getElementById("harmonic-attack-slider"),he=document.getElementById("harmonic-release-slider"),je=document.getElementById("transpose-semitones-slider"),He=document.getElementById("transpose-cents-slider"),me=document.getElementById("harmonic-attack-value-label"),pe=document.getElementById("harmonic-release-value-label"),Re=document.getElementById("transpose-semitones-value-label"),Je=document.getElementById("transpose-cents-value-label"),Qe=document.getElementById("harmonic-row"),Z=document.getElementById("harmonics-container"),Z.innerHTML="",Xe(),_e.addEventListener("click",()=>{bt()}),Ve.addEventListener("click",()=>{It()}),fe.addEventListener("input",function(){$=parseFloat(this.value),me.innerHTML=this.value}),he.addEventListener("input",function(){D=parseFloat(this.value),pe.innerHTML=this.value}),je.addEventListener("input",function(){be=parseInt(this.value),Re.innerHTML=parseInt(this.value),$e()}),He.addEventListener("input",function(){Ie=parseInt(this.value),Je.innerHTML=parseInt(this.value),$e()})}function $e(){const o={...B,...N,...L};for(const s in o){const i=o[s];i.oscillators&&i.oscillators.forEach(({oscillator:a,gainNode:t,baseFrequency:e})=>{const n=be*100+Ie,u=Math.pow(2,n/1200);e*=u,a.frequency.value=e})}}function bt(){C.slice(1).length<50&&(C.push({volume:1}),ke(),oe())}function It(){C.slice(1).length>1&&(C.pop(),ke(),oe())}function Xe(){Z.innerHTML="",C.length>0&&C[0]&&(C[0].attack!==void 0&&($=parseFloat(C[0].attack),fe.value=$.toString(),me.innerHTML=$.toString()),C[0].release!==void 0&&(D=parseFloat(C[0].release),he.value=D.toString(),pe.innerHTML=D.toString())),ke()}function ke(){Z.innerHTML="",C.forEach((o,s)=>{if(s!==0){const i=document.importNode(Qe.content,!0),a=i.querySelector(".harmonic-label");a&&(a.innerHTML=`${s}`);const t=i.querySelector(".harmonic-volume-slider");t&&(t.value=o.volume,t.dataset.index=s,t.addEventListener("input",function(){const e=parseInt(this.dataset.index);C[e].volume=this.value,oe()})),Z.appendChild(i)}})}function oe(){if(Object.keys(B).length===0&&Object.keys(N).length===0)return;let o=0;for(let a=0;a<C.slice(1).length;a++){const t=parseFloat(C.slice(1)[a].volume);o+=t*t}const s=o>0?1/Math.sqrt(o):0;function i(a){const{oscillators:t,gainNode:e}=a,n=t[0].oscillator.frequency.value;for(let u=0;u<Math.min(t.length,C.slice(1).length);u++){const l=parseFloat(C.slice(1)[u].volume);t[u].gainNode.gain.value=l*s}for(let u=t.length;u<C.slice(1).length;u++){const l=parseFloat(C.slice(1)[u].volume),c=O.currentTime,r=O.createOscillator(),f=n*(u+1);r.type="sine",r.frequency.value=f*ae;const d=O.createGain();d.gain.cancelScheduledValues(c),d.gain.setValueAtTime(0,c),d.gain.linearRampToValueAtTime(l*s,c+$),r.connect(d),d.connect(e),r.start(),t.push({oscillator:r,gainNode:d,baseFrequency:f})}if(t.length>C.slice(1).length){const u=O.currentTime;for(let l=C.slice(1).length;l<t.length;l++)t[l].oscillator.stop(u+D);t.length=C.slice(1).length}Te()}for(const a in B)i(B[a]);for(const a in N)i(N[a])}function Ye(){let o=document.getElementById("reset-audio");O=new(window.AudioContext||window.webkitAudioContext),document.addEventListener("click",()=>{O.state==="suspended"&&O.resume()}),o.addEventListener("click",()=>{kt()})}function kt(){if(O){const o={...B,...N,...L};for(const s in o){const i=o[s],a=O.currentTime;i.oscillators&&i.oscillators.forEach(({oscillator:t,gainNode:e})=>{try{t.stop(a),t.disconnect(),e.disconnect()}catch(n){console.error("Error stopping oscillator:",n)}})}O.close(),Ye()}}async function Tt(){const o=document.querySelector(".midi-message");if(!navigator.requestMIDIAccess){o.textContent="MIDI is not supported in this browser";return}try{ie=await navigator.requestMIDIAccess(),ie.onstatechange=Ge,o.textContent="Waiting for MIDI Device...",Ge()}catch(s){o.textContent=`Failed to access to MIDI devices: ${s}`,console.error("MIDI Access Error:",s)}}function Ge(o){if(!ie)return;const s=document.querySelector(".midi-message"),i=ie.inputs;if(i.forEach(a=>{a.onmidimessage=q}),i.size>0){const a=[];i.forEach(t=>a.push(t.name)),s.textContent=`Connected to: ${a.join(", ")}`}else s.textContent="Waiting for MIDI device to connect..."}function q(o,s=!1){const i=o.data[0],a=o.data[1],t=o.data[2],e=document.querySelector(".active-notes-message");i===144&&(t>0?xt(a,t,s):ge(a)),i===128&&ge(a),i===176&&Et(a,t),i===224&&St(t),e.textContent=JSON.stringify(Object.keys(B))}function Te(){const o=Object.keys(B).length+Object.keys(N).length+Object.keys(L).length;if(o===0)return;const s=1/Math.sqrt(o),i=O.currentTime;for(const a in B){const{oscillators:t,gainNode:e,velocity:n}=B[a],l=n/127*mt*s,c=e.gain.value;e.gain.cancelScheduledValues(i),e.gain.setValueAtTime(c,i),e.gain.linearRampToValueAtTime(l,i+$)}}function wt(o){const s=be*100+Ie,i=Math.pow(2,s/1200);return 440*Math.pow(2,(o-69)/12)*i}function xt(o,s,i=!1){const a={...B,...N,...L};if(Object.keys(a).length>=25)return;if(N[o]){const{oscillators:c,gainNode:r}=N[o],f=O.currentTime;r.gain.cancelScheduledValues(f),r.gain.setValueAtTime(r.gain.value,f),r.gain.linearRampToValueAtTime(0,f+D),c.forEach(({oscillator:d})=>{d.stop(f+D)}),delete N[o]}B[o]&&ge(o);let t=[],e=wt(o);const n=O.createGain();n.gain.value=0;let u=0;for(let c=0;c<C.slice(1).length;c++){const r=parseFloat(C.slice(1)[c].volume);u+=r*r}const l=u>0?1/Math.sqrt(u):0;for(let c=0;c<C.slice(1).length;c++){const r=O.createOscillator(),f=e*(c+1);r.type="sine",r.frequency.value=f*ae;const d=O.createGain();d.gain.value=C.slice(1)[c].volume*l,r.connect(d),d.connect(n),r.start(),t.push({oscillator:r,gainNode:d,baseFrequency:f})}n.connect(O.destination),B[o]={oscillators:t,gainNode:n,velocity:s,midiPlayerActivated:i},Te()}function ge(o){if(B[o])if(ne)N[o]=B[o],delete B[o];else{const{oscillators:s,gainNode:i}=B[o],a=O.currentTime;i.gain.cancelScheduledValues(a),i.gain.setValueAtTime(i.gain.value,a),i.gain.linearRampToValueAtTime(0,a+D),L[o]={oscillators:s,gainNode:i,releaseEnd:a+D},delete B[o],setTimeout(()=>{L[o]&&(s.forEach(({oscillator:t})=>{t.stop(a)}),delete L[o])},D*1e3),Te()}}function Et(o,s){if(o===64){const i=ne;ne=s>=64,i&&!ne&&Mt()}}function Mt(){for(const o in N){const{oscillators:s,gainNode:i}=N[o],a=O.currentTime;i.gain.cancelScheduledValues(a),i.gain.setValueAtTime(i.gain.value,a),i.gain.linearRampToValueAtTime(0,a+D),L[o]={oscillators:s,gainNode:i,releaseEnd:a+D},delete B[o],setTimeout(()=>{L[o]&&(s.forEach(({oscillator:t})=>{t.stop(a)}),delete L[o])},D*1e3)}N={}}function St(o){const s=o/127*4-2;ae=Math.pow(2,s/12);const i={...B,...N,...L};for(const a in i){const t=i[a];t&&t.oscillators.forEach(({oscillator:e,gainNode:n,baseFrequency:u})=>{e.frequency.value=u*ae})}}function Ct(){if(A=document.getElementById("waveform-graph"),!A){console.error("Waveform graph not found");return}A.width=A.clientWidth,A.height=A.clientHeight,ye=window.getComputedStyle(A),_=A.getContext("2d"),Ze()}function Ze(){if(requestAnimationFrame(Ze),!_)return;ye.backgroundColor?_.fillStyle=ye.backgroundColor:_.fillStyle="rgb(0, 0, 0)",_.fillRect(0,0,A.width,A.height);const o={...B,...N,...L};if(Object.keys(o).length===0)return;A.width;const s=[];let i=0;for(const u in o){const l=o[u],{oscillators:c,gainNode:r}=l,f=r.gain.value;for(let d=0;d<c.length;d++){const{oscillator:h,gainNode:T}=c[d],k=h.frequency.value,y=T.gain.value*f;s.push({frequency:k,amplitude:y}),i+=y}}function a(u){let l=0;for(const c of s)l+=c.amplitude*Math.sin(2*Math.PI*c.frequency*u);return i>1?l/i:l}const t=A.width,e=A.height,n=1/pt;_.strokeStyle="rgb(0, 255, 0)",_.lineWidth=2,_.beginPath();for(let u=0;u<t;u++){const l=u/t*n,r=(1-a(l))*e/2;u==0?_.moveTo(u,r):_.lineTo(u,r)}_.stroke()}async function Ut(){const o=document.getElementById("midi-player-select-dropdown"),s=document.getElementById("midi-player-upload-button"),i=document.getElementById("midi-current-file-label"),a=document.getElementById("midi-play"),t=document.getElementById("midi-loop-checkbox"),e=document.getElementById("midi-speed-control-bar"),n=document.getElementById("midi-speed-control-value"),u=document.getElementById("midi-progress-bar"),l=document.getElementById("midi-progress-fill"),c=document.getElementById("midi-progress-handle"),r=document.getElementById("midi-current-time"),f=document.getElementById("midi-total-time");let d,h=!1,T=!1,k=!1,y=1;await p(),m();async function p(){try{const g=await fetch("midi-files.json");if(!g.ok)throw new Error(`HTTP Error! Status: ${g.status}`);const E=await g.json();for(;o.options.length>1;)o.remove(1);for(const M in E){const S=document.createElement("optgroup");S.label=M;for(const U in E[M]){const P=E[M][U],w=P.name,x=P.path,b=document.createElement("option");b.value=x,b.dataset.name=w,b.textContent=w,S.appendChild(b)}o.appendChild(S)}o.addEventListener("change",async M=>{if(M.target.selectedIndex!==0)try{const S=M.target.selectedOptions[0],P=`/harmonic-series-online-synthesizer/${S.value}`,w=S.dataset.name;await v(P,w)}catch(S){console.error("Error loading MIDI file: ",S),i.innerHTML+="Error loading MIDI file"}})}catch(g){console.error("Error loading MIDI files: ",g),i.innerHTML+="Error loading MIDI files"}}s.addEventListener("change",async function(){try{const g=this.files[0];await v(g)}catch(g){console.error("Error loading MIDI file: ",g),i.innerHTML+="Error loading MIDI file"}});async function v(g,E=""){let M;try{if(typeof g=="string"){const w=await fetch(g);if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);M=await w.arrayBuffer(),i.innerHTML="MIDI File Loaded: "+E}else if(g instanceof File)M=await g.arrayBuffer(),i.innerHTML="MIDI File Loaded: "+g.name;else if(g instanceof ArrayBuffer)M=g;else throw new Error("Invalid source type. Must be a URL string, File, or ArrayBuffer");const S=new Ae.Midi(M),U=I(S);console.log(U);const P=rt.parseMidi(new Uint8Array(U.toArray()));d&&(d.isPlaying&&d.pause(),d.timeoutId&&clearTimeout(d.timeoutId),a.textContent="Play",a.classList.remove("midi-playing"),d=null),d=new Pt(P,q,h,T,y,a,U),s.value="",o.selectedIndex=0,d&&(f.textContent=d.formatTime(d.getTotalTime()),r.textContent="0:00",c.style.left="0%",l.style.width="0%")}catch(S){console.error("Error loading MIDI file: ",S),i.innerHTML="Error loading MIDI file"}}function I(g){let E=new Ae.Midi;E.header=g.header;let M=E.addTrack();return g.tracks.forEach(S=>{M.notes.push(...S.notes),S.controlChanges&&Object.values(S.controlChanges).forEach(U=>{U.forEach(P=>{M.addCC(P)})}),S.pitchBends&&S.pitchBends.forEach(U=>{M.addPitchBend(U)})}),E}function m(){a.addEventListener("click",()=>{d&&(d.isPlaying?(a.textContent="Play",a.classList.remove("midi-playing"),h=!0,d.pause()):(a.textContent="Pause",a.classList.add("midi-playing"),h=!1,d.play()))}),t.addEventListener("change",()=>{T=t.checked,d&&d.setLooping(T)}),e.addEventListener("input",()=>{y=parseFloat(e.value),n.textContent=y.toFixed(2)+"x",d&&d.setPlaybackSpeed(y)}),u.addEventListener("mousedown",U=>{d&&(k=!0,M(U),document.addEventListener("mousemove",g),document.addEventListener("mouseup",E))});function g(U){k&&M(U)}function E(){k=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",E)}function M(U){if(!d)return;const P=u.getBoundingClientRect(),x=Math.max(0,Math.min(P.width,U.clientX-P.left))/P.width*100;c.style.left=`${x}%`,l.style.width=`${x}%`;const b=d.setPlaybackPosition(x);r.textContent=d.formatTime(b)}requestAnimationFrame(S);function S(){if(d&&d.isPlaying&&!k){const U=d.getCurrentPosition(),P=d.getProgressPercentage();r.textContent=d.formatTime(U),c.style.left=`${P}%`,l.style.width=`${P}%`}requestAnimationFrame(S)}}}class Pt{constructor(s,i,a=!1,t=!1,e=1,n=null,u=null){this.MIDIData=s,this.onMIDIEvent=i,this.isPlaying=a,this.isLooping=t,this.playbackSpeed=e,this.timeoutId=null,this.maxSimultaneousEvents=15,this.playButton=n,this.originalMIDI=u,this.activeNotes=new Set;const{processedEvents:l,tempoEvents:c}=this.preprocessEvents();this.processedEvents=l,this.tempoEvents=c,this.currentIndex=0,this.startTime=0,this.pauseTime=0,this.totalTime=this.calculateTotalTime(),console.log(this.formatTime(this.totalTime))}preprocessEvents(){if(!this.MIDIData||!this.MIDIData.tracks||this.MIDIData.tracks.length===0)return{processedEvents:[],tempoEvents:[{tick:0,tempo:5e5}]};const s=[],i=[],a=this.MIDIData.header.ticksPerBeat||480;return this.MIDIData.tracks.forEach(t=>{let e=0;t.forEach(n=>{e+=n.deltaTime,n.type==="setTempo"&&i.push({tick:e,tempo:n.microsecondsPerBeat})})}),i.sort((t,e)=>t.tick-e.tick),(i.length===0||i[0].tick>0)&&i.unshift({tick:0,tempo:5e5}),this.MIDIData.tracks.forEach((t,e)=>{let n=0;t.forEach(u=>{if(n+=u.deltaTime,["noteOn","noteOff","controller"].includes(u.type)){const l=this.ticksToMs(n,i,a);s.push({...u,absoluteTick:n,absoluteTime:l,track:e})}})}),this.originalMIDI&&this.originalMIDI.tracks.forEach((t,e)=>{t.pitchBends.forEach(n=>{const u=this.ticksToMs(n.ticks,i,a);s.push({type:"pitchBend",value:n.value,absoluteTick:n.ticks,absoluteTime:u,track:e})})}),s.sort((t,e)=>t.absoluteTick!==e.absoluteTick?t.absoluteTick-e.absoluteTick:t.type==="noteOff"&&e.type==="noteOn"?-1:t.type==="noteOn"&&e.type==="noteOff"?1:t.track-e.track),{processedEvents:s,tempoEvents:i}}ticksToMs(s,i,a){let t=0,e=0,n=i[0].tempo;for(let l=0;l<i.length;l++){const c=i[l];if(c.tick<s){const r=c.tick-e;t+=r/a*(n/1e3),e=c.tick,n=c.tempo}else break}const u=s-e;return t+=u/a*(n/1e3),t}calculateTotalTime(){return this.processedEvents.length===0?0:this.processedEvents[this.processedEvents.length-1].absoluteTime+500}formatTime(s){const i=Math.floor(s/1e3),a=Math.floor(i/60),t=i%60;return`${a}:${t.toString().padStart(2,"0")}`}play(){if(!this.isPlaying){if(this.isPlaying=!0,this.currentIndex>=this.processedEvents.length&&(this.currentIndex=0),this.pauseTime>0)this.startTime=performance.now()-this.pauseTime/this.playbackSpeed;else{const s=this.processedEvents[this.currentIndex]||{absoluteTime:0};this.startTime=performance.now()-s.absoluteTime/this.playbackSpeed,console.log(performance.now()),console.log(s.absoluteTime),console.log(this.playbackSpeed)}this.processEvents(),this.playButton&&(this.playButton.textContent="Pause",this.playButton.classList.add("midi-playing"))}}pause(){if(!this.isPlaying)return;this.pauseTime=this.getCurrentPosition(),this.isPlaying=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null);const s={data:new Uint8Array([224,0,64])};this.onMIDIEvent(s,!0),this.releaseActiveNotes(),this.playButton&&(this.playButton.textContent="Play",this.playButton.classList.contains("midi-playing")&&this.playButton.classList.remove("midi-playing"))}setLooping(s){this.isLooping=s}setPlaybackSpeed(s){s<=0&&(s=.1);const i=this.isPlaying,a=this.getCurrentPosition();i&&this.pause(),this.playbackSpeed=s,this.pauseTime=a,i&&this.play()}getTotalTime(){return this.totalTime}getCurrentPosition(){return this.isPlaying?(performance.now()-this.startTime)*this.playbackSpeed:this.currentIndex<this.processedEvents.length?this.processedEvents[this.currentIndex.absoluteTime]:this.pauseTime||0}getProgressPercentage(){return this.getCurrentPosition()/this.totalTime*100}setPlaybackPosition(s){s<0&&(s=0),s>100&&(s=100);const i=s/100*this.totalTime,a=this.isPlaying;return a&&this.pause(),this.currentIndex=this.findEventIndexByTime(i),this.pauseTime=i,a&&this.play(),i}findEventIndexByTime(s){for(let i=0;i<this.processedEvents.length;i++)if(this.processedEvents[i].absoluteTime>=s)return i;return this.processedEvents.length-1}processEvents(){if(!this.isPlaying||this.processedEvents.length===0)return;const s=this.getCurrentPosition();let i=0;for(;this.currentIndex<this.processedEvents.length&&this.processedEvents[this.currentIndex].absoluteTime<=s;){if(i<=this.maxSimultaneousEvents){const a=this.processedEvents[this.currentIndex];this.processMIDIEvent(a),i+=1}this.currentIndex++}if(this.currentIndex>=this.processedEvents.length)if(this.isLooping)this.currentIndex=0,this.startTime=performance.now(),this.pauseTime=0;else{console.log("Finished"),this.pause();return}this.timeoutId=setTimeout(()=>this.processEvents(),10)}processMIDIEvent(s){let i={};switch(s.type){case"noteOn":i={data:new Uint8Array([144,s.noteNumber,s.velocity||64])};break;case"noteOff":i={data:new Uint8Array([128,s.noteNumber,s.velocity||64])};break;case"controller":i={data:new Uint8Array([176,s.noteNumber,s.velocity||64])};break;case"pitchBend":const a=64+Math.min(64,s.value*64);console.log(a),i={data:new Uint8Array([224,0,a])};break;default:return}this.onMIDIEvent(i,!0)}releaseActiveNotes(){const s={...B,...N,...L};for(const i in s){const a=s[i];if(a.midiPlayerActivated){const t=O.currentTime;a.oscillators&&a.oscillators.forEach(({oscillator:e,gainNode:n})=>{try{e.stop(t),e.disconnect(),n.disconnect()}catch(u){console.error("Error stopping oscillator:",u)}}),a.gainNode&&(a.gainNode.gain.cancelScheduledValues(t),a.gainNode.gain.setValueAtTime(0,t),a.gainNode.disconnect()),B[i]&&delete B[i],N[i]&&delete N[i],L[i]&&delete L[i]}}}}function Bt(){let o=4,s=100,i=64,a=64,t=.3,e=null,n={1:!1,2:!1},u=!1,l=null;const c={a:0,w:1,s:2,e:3,d:4,f:5,t:6,g:7,y:8,h:9,u:10,j:11,k:12,o:13,l:14,p:15,";":16,"'":17},r={},f=document.querySelectorAll(".piano-white-key"),d=document.querySelectorAll(".piano-black-key"),h=[...f,...d],T=document.querySelector('.piano-settings-button-double[data-key="shift"]'),k=document.querySelector('.piano-settings-button[data-key="z"]'),y=document.querySelector('.piano-settings-button[data-key="x"]'),p=document.querySelector('.piano-info-label[data="octave-display"]'),v=document.querySelector('.piano-settings-button[data-key="c"]'),I=document.querySelector('.piano-settings-button[data-key="v"]'),m=document.querySelector('.piano-info-label[data="velocity-display"]'),g=document.querySelector('.piano-settings-button[data-key="1"]'),E=document.querySelector('.piano-settings-button[data-key="2"]');function M(){p&&(p.textContent=`Current Octave: ${o}`)}function S(){m&&(m.textContent=`Current Velocity: ${s}`)}function U(x){return 60+x+12*(o-4)}function P(){a=64+-n[1]*64+n[2]*64,e===null&&(e=setInterval(x,16));function x(){if(Math.abs(i-a)<1){i=a,clearInterval(e),e=null,b(i);return}i+=(a-i)*t,b(Math.round(i))}function b(F){const j={data:new Uint8Array([224,0,F])};q(j)}}function w(x,b=!0){x&&(b&&!x.classList.contains("active")?x.classList.add("active"):!b&&x.classList.contains("active")&&x.classList.remove("active"))}document.addEventListener("mousedown",()=>{u=!0}),document.addEventListener("mouseup",()=>{if(u=!1,l){const x=U(parseInt(l.dataset.note)),b={data:new Uint8Array([128,x,s])};q(b),l=null}}),h.forEach(x=>{x.addEventListener("mousedown",()=>{const b=U(parseInt(x.dataset.note));l=x;const F={data:new Uint8Array([144,b,s])};q(F),w(x,!0)}),x.addEventListener("mouseenter",()=>{if(u){const b=U(parseInt(x.dataset.note));l=x;const F={data:new Uint8Array([144,b,s])};q(F),w(x,!0)}}),x.addEventListener("mouseleave",()=>{if(u){const b=U(parseInt(x.dataset.note));l=x;const F={data:new Uint8Array([128,b,s])};l=null,q(F),w(x,!1)}}),x.addEventListener("mouseup",()=>{const b=U(parseInt(x.dataset.note));l=x;const F={data:new Uint8Array([128,b,s])};q(F),w(x,!1)})}),T.addEventListener("mousedown",()=>{const x={data:new Uint8Array([176,64,127])};q(x),w(T,!0)}),T.addEventListener("mouseup",()=>{const x={data:new Uint8Array([176,64,0])};q(x),w(T,!1)}),k.addEventListener("mousedown",()=>{o>0&&(o--,M()),w(k,!0)}),k.addEventListener("mouseup",()=>{w(k,!1)}),y.addEventListener("mousedown",()=>{o<7&&(o++,M()),w(y,!0)}),y.addEventListener("mouseup",()=>{w(y,!1)}),v.addEventListener("mousedown",()=>{s>1&&(s=Math.max(1,s-5),S()),w(v,!0)}),v.addEventListener("mouseup",()=>{w(v,!1)}),I.addEventListener("mousedown",()=>{s<128&&(s=Math.min(127,s+5),S()),w(I,!0)}),I.addEventListener("mouseup",()=>{w(I,!1)}),g.addEventListener("mousedown",()=>{n[1]=!0,P(),w(g,!0)}),g.addEventListener("mouseup",()=>{n[1]=!1,P(),w(g,!1)}),E.addEventListener("mousedown",()=>{n[2]=!0,P(),w(E,!0)}),E.addEventListener("mouseup",()=>{n[2]=!1,P(),w(E,!1)}),document.addEventListener("keydown",x=>{let b=x.key.toLowerCase();if(b==="!"&&(b="1"),b==="@"&&(b="2"),b==="shift"){const F={data:new Uint8Array([176,64,127])};q(F),w(T,!0)}if(b==="z"&&(o>0&&(o--,M()),w(k,!0)),b==="x"&&(o<7&&(o++,M()),w(y,!0)),b==="c"&&(s>1&&(s=Math.max(1,s-5),S()),w(v,!0)),b==="v"&&(s<128&&(s=Math.min(127,s+5),S()),w(I,!0)),b==="1"&&(n[1]=!0,P(),w(g,!0)),b==="2"&&(n[2]=!0,P(),w(E,!0)),c[b]!==void 0){const F=c[b],j=U(F),ee=Array.from(h).find(G=>{const W=G.querySelector(".key-label");return W&&W.textContent.toLowerCase()===b});if(ee&&w(ee,!0),!r[b]){r[b]=j;const G={data:new Uint8Array([144,j,s])};q(G)}}}),document.addEventListener("keyup",x=>{let b=x.key.toLowerCase();if(b==="!"&&(b="1"),b==="@"&&(b="2"),b==="shift"){const F={data:new Uint8Array([176,64,0])};q(F),w(T,!1)}if(b==="z"&&w(k,!1),b==="x"&&w(y,!1),b==="c"&&w(v,!1),b==="v"&&w(I,!1),b==="1"&&(n[1]=!1,P(),w(g,!1)),b==="2"&&(n[2]=!1,P(),w(E,!1)),c[b]!==void 0&&r[b]){const F=r[b],j=Array.from(h).find(G=>{const W=G.querySelector(".key-label");return W&&W.textContent.toLowerCase()===b});j&&w(j,!1);const ee={data:new Uint8Array([128,F,s])};q(ee),delete r[b]}})}
